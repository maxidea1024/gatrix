"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9353],{6376(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"api/client-api","title":"Client API Documentation","description":"Public API endpoints that can be called directly from game clients.","source":"@site/docs/api/client-api.md","sourceDirName":"api","slug":"/api/client-api","permalink":"/docs/api/client-api","draft":false,"unlisted":false,"editUrl":"https://github.com/your-org/gatrix/tree/main/docs/docs/api/client-api.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"New Relic ?\ufffd\ub3d9","permalink":"/docs/integrations/new-relic"},"next":{"title":"Server SDK API Documentation","permalink":"/docs/api/server-sdk-api"}}');var l=i(4848),t=i(8453);const a={sidebar_position:1},r="Client API Documentation",c={},d=[{value:"Features",id:"features",level:2},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"1. Client Version Information",id:"1-client-version-information",level:3},{value:"Query Parameters",id:"query-parameters",level:4},{value:"Response",id:"response",level:4},{value:"Cache Information",id:"cache-information",level:4},{value:"2. Game World List",id:"2-game-world-list",level:3},{value:"Response",id:"response-1",level:4},{value:"Filtering",id:"filtering",level:4},{value:"Cache Information",id:"cache-information-1",level:4},{value:"3. Cache Statistics",id:"3-cache-statistics",level:3},{value:"Response",id:"response-2",level:4},{value:"Cache System",id:"cache-system",level:2},{value:"Local Memory Caching",id:"local-memory-caching",level:3},{value:"BullMQ-based Queue System",id:"bullmq-based-queue-system",level:3},{value:"Cache Invalidation Scenarios",id:"cache-invalidation-scenarios",level:3},{value:"Queue System Features",id:"queue-system-features",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Response Times",id:"response-times",level:3},{value:"Memory Usage",id:"memory-usage",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"JavaScript (Game Client)",id:"javascript-game-client",level:3},{value:"Unity C# (Game Client)",id:"unity-c-game-client",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"Log Checking",id:"log-checking",level:3},{value:"Cache and Queue Statistics Monitoring",id:"cache-and-queue-statistics-monitoring",level:3},{value:"BullMQ Dashboard (Optional)",id:"bullmq-dashboard-optional",level:3}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"client-api-documentation",children:"Client API Documentation"})}),"\n",(0,l.jsx)(n.p,{children:"Public API endpoints that can be called directly from game clients."}),"\n",(0,l.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"No Authentication Required"}),": Can be called directly from clients"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"No Rate Limiting"}),": Handles high-volume requests"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"High-Performance Caching"}),": Fast response with local memory caching"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Automatic Cache Invalidation"}),": Real-time cache updates via pub/sub when admin makes changes"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,l.jsx)(n.h3,{id:"1-client-version-information",children:"1. Client Version Information"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GET /api/v1/client/client-version\n"})}),"\n",(0,l.jsx)(n.p,{children:"Retrieves version information for game clients."}),"\n",(0,l.jsx)(n.h4,{id:"query-parameters",children:"Query Parameters"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Parameter"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"channel"}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"Channel filter (e.g., A1, PC)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"subChannel"}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"Sub-channel filter (e.g., QQ, WeChat, iOS)"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"response",children:"Response"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "data": {\n    "versions": [\n      {\n        "id": 1,\n        "channel": "PC",\n        "subChannel": "Steam",\n        "clientVersion": "1.0.0",\n        "gameServerAddress": "https://game.example.com",\n        "gameServerAddressForWhiteList": "https://game-vip.example.com",\n        "patchAddress": "https://patch.example.com",\n        "patchAddressForWhiteList": "https://patch-vip.example.com",\n        "guestModeAllowed": true,\n        "externalClickLink": "https://website.example.com",\n        "customPayload": {\n          "feature1": true,\n          "setting1": "value1"\n        },\n        "createdAt": "2024-01-01T00:00:00.000Z",\n        "updatedAt": "2024-01-01T00:00:00.000Z"\n      }\n    ],\n    "total": 1,\n    "timestamp": "2024-01-01T00:00:00.000Z"\n  },\n  "cached": false\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"cache-information",children:"Cache Information"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache Key"}),": ",(0,l.jsx)(n.code,{children:"CLIENT_VERSION.BY_CHANNEL(channel, subChannel)"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache TTL"}),": 5 minutes (",(0,l.jsx)(n.code,{children:"DEFAULT_CONFIG.CLIENT_VERSION_TTL"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Invalidation"}),": When client versions are created/updated/deleted"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"2-game-world-list",children:"2. Game World List"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GET /api/v1/client/game-worlds\n"})}),"\n",(0,l.jsx)(n.p,{children:"Retrieves available game world list."}),"\n",(0,l.jsx)(n.h4,{id:"response-1",children:"Response"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "data": {\n    "worlds": [\n      {\n        "id": 1,\n        "worldId": "world001",\n        "name": "Main World",\n        "description": "Default game world",\n        "displayOrder": 1,\n        "createdAt": "2024-01-01T00:00:00.000Z",\n        "updatedAt": "2024-01-01T00:00:00.000Z"\n      }\n    ],\n    "total": 1,\n    "timestamp": "2024-01-01T00:00:00.000Z"\n  },\n  "cached": false\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"filtering",children:"Filtering"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"visible"}),": Only returns worlds with ",(0,l.jsx)(n.code,{children:"visible: true"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"maintenance"}),": Only returns worlds with ",(0,l.jsx)(n.code,{children:"maintenance: false"})," (not under maintenance)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"sorting"}),": Ordered by ",(0,l.jsx)(n.code,{children:"displayOrder"})," ascending"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"cache-information-1",children:"Cache Information"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache Key"}),": ",(0,l.jsx)(n.code,{children:"GAME_WORLDS.PUBLIC"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache TTL"}),": 10 minutes (",(0,l.jsx)(n.code,{children:"DEFAULT_CONFIG.GAME_WORLDS_PUBLIC_TTL"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Invalidation"}),": When game worlds are created/updated/deleted"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-cache-statistics",children:"3. Cache Statistics"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GET /api/v1/client/cache-stats\n"})}),"\n",(0,l.jsx)(n.p,{children:"Retrieves cache performance statistics (for monitoring purposes)."}),"\n",(0,l.jsx)(n.h4,{id:"response-2",children:"Response"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "data": {\n    "totalItems": 10,\n    "validItems": 8,\n    "expiredItems": 2,\n    "memoryUsage": {\n      "rss": 50331648,\n      "heapTotal": 20971520,\n      "heapUsed": 15728640,\n      "external": 1048576,\n      "arrayBuffers": 524288\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"cache-system",children:"Cache System"}),"\n",(0,l.jsx)(n.h3,{id:"local-memory-caching",children:"Local Memory Caching"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"CacheService"}),": In-memory cache management"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Automatic Expiration"}),": TTL-based automatic cleanup"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Pattern Matching"}),": Bulk deletion via regex patterns"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"bullmq-based-queue-system",children:"BullMQ-based Queue System"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"PubSubService"}),": Reliable cache invalidation queue via BullMQ"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"QueueService"}),": General-purpose queue system for email, audit logs, cleanup tasks"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Real-time Synchronization"}),": Immediate cache invalidation across all instances when admin makes changes"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Retry Mechanism"}),": Automatic retry for failed jobs (exponential backoff)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Fault Tolerance"}),": Local cache continues to work even if Redis connection fails"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"cache-invalidation-scenarios",children:"Cache Invalidation Scenarios"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Client Version Changes"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"On create/update/delete/status change"}),"\n",(0,l.jsxs)(n.li,{children:["Pattern: ",(0,l.jsx)(n.code,{children:"client_version:.*"})]}),"\n",(0,l.jsx)(n.li,{children:"Processed asynchronously via queue"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Game World Changes"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"On create/update/delete"}),"\n",(0,l.jsxs)(n.li,{children:["Key: ",(0,l.jsx)(n.code,{children:"game_worlds:public"})]}),"\n",(0,l.jsx)(n.li,{children:"Processed asynchronously via queue"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"queue-system-features",children:"Queue System Features"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"High Priority"}),": Cache invalidation jobs processed with priority 10"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Automatic Cleanup"}),": Keeps 100 completed jobs, 50 failed jobs"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Concurrency Control"}),": Maximum 5 concurrent jobs per worker"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Monitoring"}),": Real-time queue status monitoring available"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,l.jsx)(n.h3,{id:"response-times",children:"Response Times"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache Hit"}),": ~1ms"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache Miss"}),": ~50-100ms (database query)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Cache Invalidation"}),": ~2-5ms (BullMQ queue addition)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Queue Processing"}),": ~10-50ms (background processing)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"memory-usage",children:"Memory Usage"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Expected Usage"}),": ~1-5KB per item"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Automatic Cleanup"}),": Expired items cleaned every minute"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Queue Cleanup"}),": Automatic cleanup of completed/failed jobs"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Memory Monitoring"}),": Check via ",(0,l.jsx)(n.code,{children:"/api/v1/client/cache-stats"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,l.jsx)(n.h3,{id:"javascript-game-client",children:"JavaScript (Game Client)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"// Get client version information\nasync function getClientVersion(channel, subChannel) {\n  const params = new URLSearchParams();\n  if (channel) params.append('channel', channel);\n  if (subChannel) params.append('subChannel', subChannel);\n  \n  const response = await fetch(`/api/v1/client/client-version?${params}`);\n  const data = await response.json();\n  \n  if (data.success) {\n    return data.data.versions;\n  }\n  throw new Error('Failed to get client version');\n}\n\n// Get game world list\nasync function getGameWorlds() {\n  const response = await fetch('/api/v1/client/game-worlds');\n  const data = await response.json();\n  \n  if (data.success) {\n    return data.data.worlds;\n  }\n  throw new Error('Failed to get game worlds');\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"unity-c-game-client",children:"Unity C# (Game Client)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\nusing UnityEngine.Networking;\nusing System.Collections;\n\npublic class ClientAPI : MonoBehaviour\n{\n    private const string BASE_URL = "https://api.example.com/api/v1/client";\n\n    public IEnumerator GetClientVersion(string channel, string subChannel)\n    {\n        string url = $"{BASE_URL}/client-version";\n        if (!string.IsNullOrEmpty(channel))\n            url += $"?channel={channel}";\n        if (!string.IsNullOrEmpty(subChannel))\n            url += $"&subChannel={subChannel}";\n\n        using (UnityWebRequest request = UnityWebRequest.Get(url))\n        {\n            yield return request.SendWebRequest();\n\n            if (request.result == UnityWebRequest.Result.Success)\n            {\n                string json = request.downloadHandler.text;\n                // JSON parsing and processing\n                Debug.Log($"Client version data: {json}");\n            }\n        }\n    }\n\n    // Client SDK API with authentication\n    public IEnumerator GetSDKTemplates(string apiKey)\n    {\n        string url = $"{BASE_URL}/templates";\n\n        using (UnityWebRequest request = UnityWebRequest.Get(url))\n        {\n            request.SetRequestHeader("X-API-Key", apiKey);\n            request.SetRequestHeader("X-Application-Name", "your-app-name");\n\n            yield return request.SendWebRequest();\n\n            if (request.result == UnityWebRequest.Result.Success)\n            {\n                string json = request.downloadHandler.text;\n                Debug.Log($"SDK templates: {json}");\n            }\n        }\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,l.jsx)(n.h3,{id:"log-checking",children:"Log Checking"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check cache-related logs\ntail -f logs/app.log | grep -i cache\n\n# Check PubSub-related logs\ntail -f logs/app.log | grep -i pubsub\n"})}),"\n",(0,l.jsx)(n.h3,{id:"cache-and-queue-statistics-monitoring",children:"Cache and Queue Statistics Monitoring"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Call cache and queue statistics API\ncurl http://localhost:3000/api/v1/client/cache-stats\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Response Example:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "data": {\n    "cache": {\n      "totalItems": 10,\n      "validItems": 8,\n      "expiredItems": 2,\n      "memoryUsage": { ... }\n    },\n    "queue": {\n      "waiting": 0,\n      "active": 1,\n      "completed": 150,\n      "failed": 2,\n      "total": 153\n    },\n    "pubsub": {\n      "connected": true,\n      "timestamp": "2024-01-01T00:00:00.000Z"\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"bullmq-dashboard-optional",children:"BullMQ Dashboard (Optional)"}),"\n",(0,l.jsx)(n.p,{children:"Queue monitoring via BullMQ UI:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Install BullMQ UI (development environment)\nnpm install -g @bull-board/ui\n\n# Run dashboard\nbull-board\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>r});var s=i(6540);const l={},t=s.createContext(l);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);