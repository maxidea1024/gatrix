<!doctype html>
<html
  lang="ko-KR"
  dir="ltr"
  class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-features/monitoring"
  data-has-hydrated="false"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="generator" content="Docusaurus v3.8.1" />
    <title data-rh="true">Monitoring (Prometheus + Grafana) | Gatrix Documentation</title>
    <meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1" />
    <meta data-rh="true" name="twitter:card" content="summary_large_image" />
    <meta
      data-rh="true"
      property="og:image"
      content="https://gatrix-docs.example.com/docs/ko/img/docusaurus-social-card.jpg"
    />
    <meta
      data-rh="true"
      name="twitter:image"
      content="https://gatrix-docs.example.com/docs/ko/img/docusaurus-social-card.jpg"
    />
    <meta
      data-rh="true"
      property="og:url"
      content="https://gatrix-docs.example.com/docs/ko/features/monitoring"
    />
    <meta data-rh="true" property="og:locale" content="ko_KR" />
    <meta data-rh="true" property="og:locale:alternate" content="en_US" />
    <meta data-rh="true" property="og:locale:alternate" content="zh_CN" />
    <meta data-rh="true" name="docusaurus_locale" content="ko" />
    <meta data-rh="true" name="docsearch:language" content="ko" />
    <meta data-rh="true" name="docusaurus_version" content="current" />
    <meta data-rh="true" name="docusaurus_tag" content="docs-default-current" />
    <meta data-rh="true" name="docsearch:version" content="current" />
    <meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current" />
    <meta
      data-rh="true"
      property="og:title"
      content="Monitoring (Prometheus + Grafana) | Gatrix Documentation"
    />
    <meta
      data-rh="true"
      name="description"
      content="This guide explains how Gatrix integrates Prometheus and Grafana for monitoring in both development and production."
    />
    <meta
      data-rh="true"
      property="og:description"
      content="This guide explains how Gatrix integrates Prometheus and Grafana for monitoring in both development and production."
    />
    <link data-rh="true" rel="icon" href="/docs/ko/img/favicon.ico" />
    <link
      data-rh="true"
      rel="canonical"
      href="https://gatrix-docs.example.com/docs/ko/features/monitoring"
    />
    <link
      data-rh="true"
      rel="alternate"
      href="https://gatrix-docs.example.com/docs/features/monitoring"
      hreflang="en-US"
    />
    <link
      data-rh="true"
      rel="alternate"
      href="https://gatrix-docs.example.com/docs/ko/features/monitoring"
      hreflang="ko-KR"
    />
    <link
      data-rh="true"
      rel="alternate"
      href="https://gatrix-docs.example.com/docs/zh-Hans/features/monitoring"
      hreflang="zh-CN"
    />
    <link
      data-rh="true"
      rel="alternate"
      href="https://gatrix-docs.example.com/docs/features/monitoring"
      hreflang="x-default"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      href="/docs/ko/blog/rss.xml"
      title="Gatrix Documentation RSS Feed"
    />
    <link
      rel="alternate"
      type="application/atom+xml"
      href="/docs/ko/blog/atom.xml"
      title="Gatrix Documentation Atom Feed"
    />
    <link rel="stylesheet" href="/docs/ko/assets/css/styles.7af99d74.css" />
    <script src="/docs/ko/assets/js/runtime~main.a76f5c68.js" defer="defer"></script>
    <script src="/docs/ko/assets/js/main.483d4c46.js" defer="defer"></script>
  </head>
  <body class="navigation-with-keyboard">
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
      <defs>
        <symbol id="theme-svg-external-link" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"
          />
        </symbol>
      </defs>
    </svg>
    <script>
      (!(function () {
        var t = 'light';
        var e =
          (function () {
            try {
              return new URLSearchParams(window.location.search).get('docusaurus-theme');
            } catch (t) {}
          })() ||
          (function () {
            try {
              return window.localStorage.getItem('theme');
            } catch (t) {}
          })();
        (document.documentElement.setAttribute('data-theme', e || t),
          document.documentElement.setAttribute('data-theme-choice', e || t));
      })(),
        (function () {
          try {
            const c = new URLSearchParams(window.location.search).entries();
            for (var [t, e] of c)
              if (t.startsWith('docusaurus-data-')) {
                var a = t.replace('docusaurus-data-', 'data-');
                document.documentElement.setAttribute(a, e);
              }
          } catch (t) {}
        })());
    </script>
    <div id="__docusaurus">
      <link rel="preload" as="image" href="/docs/ko/img/logo.svg" />
      <div role="region" aria-label="본문으로 건너뛰기">
        <a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback"
          >본문으로 건너뛰기</a
        >
      </div>
      <nav aria-label="메인" class="theme-layout-navbar navbar navbar--fixed-top">
        <div class="navbar__inner">
          <div class="theme-layout-navbar-left navbar__items">
            <button
              aria-label="사이드바 펼치거나 접기"
              aria-expanded="false"
              class="navbar__toggle clean-btn"
              type="button"
            >
              <svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true">
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-miterlimit="10"
                  stroke-width="2"
                  d="M4 7h22M4 15h22M4 23h22"
                ></path>
              </svg></button
            ><a class="navbar__brand" href="/docs/ko/"
              ><div class="navbar__logo">
                <img
                  src="/docs/ko/img/logo.svg"
                  alt="Gatrix Logo"
                  class="themedComponent_mlkZ themedComponent--light_NVdE"
                /><img
                  src="/docs/ko/img/logo.svg"
                  alt="Gatrix Logo"
                  class="themedComponent_mlkZ themedComponent--dark_xIcU"
                />
              </div>
              <b class="navbar__title text--truncate">Gatrix</b></a
            ><a class="navbar__item navbar__link" href="/docs/ko/intro">Documentation</a
            ><a class="navbar__item navbar__link" href="/docs/ko/blog">Blog</a>
          </div>
          <div class="theme-layout-navbar-right navbar__items navbar__items--right">
            <div class="navbar__item dropdown dropdown--hoverable dropdown--right">
              <a
                href="#"
                aria-haspopup="true"
                aria-expanded="false"
                role="button"
                class="navbar__link"
                ><svg
                  viewBox="0 0 24 24"
                  width="20"
                  height="20"
                  aria-hidden="true"
                  class="iconLanguage_nlXk"
                >
                  <path
                    fill="currentColor"
                    d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"
                  ></path></svg
                >한국어</a
              >
              <ul class="dropdown__menu">
                <li>
                  <a
                    href="/docs/features/monitoring"
                    target="_self"
                    rel="noopener noreferrer"
                    class="dropdown__link"
                    lang="en-US"
                    >English</a
                  >
                </li>
                <li>
                  <a
                    href="/docs/ko/features/monitoring"
                    target="_self"
                    rel="noopener noreferrer"
                    class="dropdown__link dropdown__link--active"
                    lang="ko-KR"
                    >한국어</a
                  >
                </li>
                <li>
                  <a
                    href="/docs/zh-Hans/features/monitoring"
                    target="_self"
                    rel="noopener noreferrer"
                    class="dropdown__link"
                    lang="zh-CN"
                    >简体中文</a
                  >
                </li>
              </ul>
            </div>
            <a
              href="https://github.com/your-org/gatrix"
              target="_blank"
              rel="noopener noreferrer"
              class="navbar__item navbar__link header-github-link"
              aria-label="GitHub repository"
            ></a>
            <div class="toggle_vylO colorModeToggle_DEke">
              <button
                class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS"
                type="button"
                disabled=""
                title="system mode"
                aria-label="어두운 모드와 밝은 모드 전환하기 (현재 system mode)"
              >
                <svg
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  aria-hidden="true"
                  class="toggleIcon_g3eP lightToggleIcon_pyhR"
                >
                  <path
                    fill="currentColor"
                    d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"
                  ></path></svg
                ><svg
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  aria-hidden="true"
                  class="toggleIcon_g3eP darkToggleIcon_wfgR"
                >
                  <path
                    fill="currentColor"
                    d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"
                  ></path></svg
                ><svg
                  viewBox="0 0 24 24"
                  width="24"
                  height="24"
                  aria-hidden="true"
                  class="toggleIcon_g3eP systemToggleIcon_QzmC"
                >
                  <path
                    fill="currentColor"
                    d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"
                  ></path>
                </svg>
              </button>
            </div>
            <div class="navbarSearchContainer_Bca1"></div>
          </div>
        </div>
        <div role="presentation" class="navbar-sidebar__backdrop"></div>
      </nav>
      <div
        id="__docusaurus_skipToContent_fallback"
        class="theme-layout-main main-wrapper mainWrapper_z2l0"
      >
        <div class="docsWrapper_hBAB">
          <button
            aria-label="맨 위로 스크롤하기"
            class="clean-btn theme-back-to-top-button backToTopButton_sjWU"
            type="button"
          ></button>
          <div class="docRoot_UBD9">
            <main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH">
              <div class="container padding-top--md padding-bottom--lg">
                <div class="row">
                  <div class="col docItemCol_VOVn">
                    <div class="docItemContainer_Djhp">
                      <article>
                        <div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo">
                          <button type="button" class="clean-btn tocCollapsibleButton_TO0P">
                            이 페이지에서
                          </button>
                        </div>
                        <div class="theme-doc-markdown markdown">
                          <header><h1>Monitoring (Prometheus + Grafana)</h1></header>
                          <p>
                            This guide explains how Gatrix integrates Prometheus and Grafana for
                            monitoring in both development and production.
                          </p>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">
                            Overview<a
                              href="#overview"
                              class="hash-link"
                              aria-label="Overview에 대한 직접 링크"
                              title="Overview에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ul>
                            <li>
                              Prometheus scrapes metrics from services discovered via Backend
                              HTTP-SD endpoint using existing etcd/Redis service discovery.
                            </li>
                            <li>
                              Grafana is pre-provisioned to use Prometheus as the default data
                              source and ships with a starter dashboard.
                            </li>
                            <li>
                              Admin Panel has a Grafana shortcut at the bottom of the sidebar (opens
                              in a new tab).
                            </li>
                          </ul>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">
                            Architecture<a
                              href="#architecture"
                              class="hash-link"
                              aria-label="Architecture에 대한 직접 링크"
                              title="Architecture에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ul>
                            <li>
                              Prometheus<!-- -->
                              <ul>
                                <li>Runs in Docker.</li>
                                <li>
                                  Retention and scrape interval are configurable via environment
                                  variables.
                                </li>
                                <li>
                                  Targets are discovered dynamically from Backend:
                                  <code>/api/v1/public/monitoring/prometheus/targets</code>.
                                </li>
                              </ul>
                            </li>
                            <li>
                              Backend HTTP Service Discovery<!-- -->
                              <ul>
                                <li>
                                  Uses serviceDiscoveryService.getServices() to fetch active
                                  services from etcd/Redis.
                                </li>
                                <li>
                                  Exposes Prometheus HTTP-SD JSON with each service&#x27;s
                                  <code>internalAddress</code> and a suitable
                                  <code>metrics_path</code>.
                                </li>
                              </ul>
                            </li>
                            <li>
                              Grafana<!-- -->
                              <ul>
                                <li>Runs in Docker.</li>
                                <li>
                                  Auto-provisioned with Prometheus datasource (<a
                                    href="http://prometheus:9090"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    >http://prometheus:9090</a
                                  >) and a sample &quot;Gatrix Overview&quot; dashboard.
                                </li>
                              </ul>
                            </li>
                          </ul>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="ports">
                            Ports<a
                              href="#ports"
                              class="hash-link"
                              aria-label="Ports에 대한 직접 링크"
                              title="Ports에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ul>
                            <li>Prometheus: host 49090 -&gt; container 9090</li>
                            <li>Grafana: host 44000 -&gt; container 3000</li>
                          </ul>
                          <p>You can override host ports via environment variables:</p>
                          <ul>
                            <li><code>PROMETHEUS_PORT</code> (default 49090)</li>
                            <li><code>GRAFANA_PORT</code> (default 44000)</li>
                          </ul>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment-variables">
                            Environment Variables<a
                              href="#environment-variables"
                              class="hash-link"
                              aria-label="Environment Variables에 대한 직접 링크"
                              title="Environment Variables에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <p>Prometheus (both dev/prod):</p>
                          <ul>
                            <li><code>PROM_SCRAPE_INTERVAL</code>: default <code>15s</code></li>
                            <li><code>PROM_RETENTION_TIME</code>: default <code>14d</code></li>
                          </ul>
                          <p>Grafana (both dev/prod):</p>
                          <ul>
                            <li>
                              <code>GRAFANA_ADMIN_USER</code>: default <code>admin</code> (mapped to
                              <code>GF_SECURITY_ADMIN_USER</code>)
                            </li>
                            <li>
                              <code>GRAFANA_ADMIN_PASSWORD</code>: default
                              <code>admin</code> (mapped to <code>GF_SECURITY_ADMIN_PASSWORD</code>)
                            </li>
                            <li>
                              <code>GF_USERS_ALLOW_SIGN_UP</code>: defaults to <code>false</code>
                            </li>
                          </ul>
                          <p>Backend:</p>
                          <ul>
                            <li>
                              <code>PROMETHEUS_IN_DOCKER</code>: default <code>true</code>. Set to
                              <code>false</code> if Prometheus runs outside Docker (e.g., on host
                              machine or separate monitoring server).
                            </li>
                          </ul>
                          <p>Frontend:</p>
                          <ul>
                            <li>
                              <code>VITE_GRAFANA_URL</code>: Optional. If set, the Admin Panel
                              shortcut uses this URL; otherwise it defaults to
                              <code>http(s)://&lt;host&gt;:44000</code>.
                            </li>
                          </ul>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose">
                            Docker Compose<a
                              href="#docker-compose"
                              class="hash-link"
                              aria-label="Docker Compose에 대한 직접 링크"
                              title="Docker Compose에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <p>Development:</p>
                          <ul>
                            <li>Services added: <code>prometheus</code>, <code>grafana</code></li>
                            <li>
                              Persistent volumes: <code>prometheus_dev_data</code>,
                              <code>grafana_dev_data</code>
                            </li>
                            <li>
                              Prometheus entrypoint performs env substitution and starts Prometheus
                              with <code>--web.enable-lifecycle</code>.
                            </li>
                          </ul>
                          <p>Production:</p>
                          <ul>
                            <li>Services added: <code>prometheus</code>, <code>grafana</code></li>
                            <li>
                              Persistent volumes: <code>prometheus_data</code>,
                              <code>grafana_data</code>
                            </li>
                          </ul>
                          <p>Files:</p>
                          <ul>
                            <li>
                              <code>docker/prometheus/prometheus.base.yml</code> (template; interval
                              injected by entrypoint)
                            </li>
                            <li><code>docker/prometheus/entrypoint.sh</code></li>
                            <li>
                              <code>docker/grafana/provisioning/datasources/datasource.yml</code>
                            </li>
                            <li>
                              <code>docker/grafana/provisioning/dashboards/dashboards.yml</code>
                            </li>
                            <li><code>docker/grafana/dashboards/gatrix-overview.json</code></li>
                          </ul>
                          <h2
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="backend-http-sd-endpoint"
                          >
                            Backend HTTP-SD Endpoint<a
                              href="#backend-http-sd-endpoint"
                              class="hash-link"
                              aria-label="Backend HTTP-SD Endpoint에 대한 직접 링크"
                              title="Backend HTTP-SD Endpoint에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <p>Path: <code>/api/v1/public/monitoring/prometheus/targets</code></p>
                          <p>Behavior:</p>
                          <ul>
                            <li>Returns an array of target groups in Prometheus HTTP-SD format.</li>
                            <li>
                              Uses each service&#x27;s <code>internalAddress</code> and determines a
                              metrics port/path per service type (e.g., chat -&gt; 9090
                              <code>/metrics</code>).
                            </li>
                            <li>
                              Safe fallback: returns <code>[]</code> on internal errors to avoid
                              Prometheus failures.
                            </li>
                          </ul>
                          <h2
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="enabling-metrics-per-service"
                          >
                            Enabling Metrics Per Service<a
                              href="#enabling-metrics-per-service"
                              class="hash-link"
                              aria-label="Enabling Metrics Per Service에 대한 직접 링크"
                              title="Enabling Metrics Per Service에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ul>
                            <li>
                              Chat Server: Already integrated via <code>prom-client</code>. Enable
                              with <code>MONITORING_ENABLED=true</code>, metrics served on
                              <code>METRICS_PORT=9090</code>.
                            </li>
                            <li>
                              Backend &amp; Event Lens: Planned to use
                              <code>prom-client</code> similarly to Chat Server.<!-- -->
                              <ul>
                                <li>
                                  Add <code>/metrics</code> endpoint guarded by
                                  <code>MONITORING_ENABLED</code>.
                                </li>
                                <li>Expose default process metrics and HTTP request metrics.</li>
                              </ul>
                            </li>
                          </ul>
                          <p>
                            Note: We will request permission before installing new dependencies
                            (prom-client) in these packages.
                          </p>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="sdk-metrics-server">
                            SDK Metrics Server<a
                              href="#sdk-metrics-server"
                              class="hash-link"
                              aria-label="SDK Metrics Server에 대한 직접 링크"
                              title="SDK Metrics Server에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <p>
                            The Server SDK provides an independent metrics server for Prometheus
                            scraping. All services using the SDK can expose metrics on a consistent
                            port (default: 9337).
                          </p>
                          <h3 class="anchor anchorWithStickyNavbar_LWe7" id="quick-setup">
                            Quick Setup<a
                              href="#quick-setup"
                              class="hash-link"
                              aria-label="Quick Setup에 대한 직접 링크"
                              title="Quick Setup에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <div
                            class="language-typescript codeBlockContainer_Ckt0 theme-code-block"
                            style="--prism-color: #393a34; --prism-background-color: #f6f8fa"
                          >
                            <div class="codeBlockContent_QJqH">
                              <pre
                                tabindex="0"
                                class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"
                                style="color: #393a34; background-color: #f6f8fa"
                              ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> GatrixServerSDK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> createMetricsServer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getLogger </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@gatrix/server-sdk&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> logger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getLogger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;MY-SERVER&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Create SDK with required identification fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sdk </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">GatrixServerSDK</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gatrixUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:45000&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiToken</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;your-api-token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  applicationName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;my-game-server&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;worldd&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// Required: service name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;kr-1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// Required: service group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;env_prod&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Required: environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metrics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9337</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Optional: default is 9337</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Create standalone metrics server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> metricsServer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createMetricsServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9337</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  applicationName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;my-game-server&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;worldd&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  group</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;kr-1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;env_prod&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Start metrics server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metricsServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre>
                            </div>
                          </div>
                          <h3 class="anchor anchorWithStickyNavbar_LWe7" id="default-labels">
                            Default Labels<a
                              href="#default-labels"
                              class="hash-link"
                              aria-label="Default Labels에 대한 직접 링크"
                              title="Default Labels에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <p>All SDK metrics automatically include these default labels:</p>
                          <ul>
                            <li><code>sdk</code>: <code>gatrix-server-sdk</code></li>
                            <li><code>service</code>: Service name from config</li>
                            <li><code>group</code>: Service group from config</li>
                            <li><code>environment</code>: Environment from config</li>
                            <li><code>application</code>: Application name from config</li>
                          </ul>
                          <p>
                            These labels enable filtering and aggregation in Grafana dashboards.
                          </p>
                          <h3
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="service-discovery-integration"
                          >
                            Service Discovery Integration<a
                              href="#service-discovery-integration"
                              class="hash-link"
                              aria-label="Service Discovery Integration에 대한 직접 링크"
                              title="Service Discovery Integration에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <p>
                            When registering a service, the SDK automatically reports the
                            <code>metricsApi</code> port:
                          </p>
                          <div
                            class="language-typescript codeBlockContainer_Ckt0 theme-code-block"
                            style="--prism-color: #393a34; --prism-background-color: #f6f8fa"
                          >
                            <div class="codeBlockContent_QJqH">
                              <pre
                                tabindex="0"
                                class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"
                                style="color: #393a34; background-color: #f6f8fa"
                              ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> sdk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">registerService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> service</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;worldd&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;kr-1&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    game</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7777</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Named port: { serviceName: port }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    web</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// metricsApi is automatically added from SDK config (default: 9337)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  status</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ready&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre>
                            </div>
                          </div>
                          <p>
                            Prometheus can then discover and scrape metrics from all registered
                            services via the Backend HTTP-SD endpoint.
                          </p>
                          <h3 class="anchor anchorWithStickyNavbar_LWe7" id="custom-metrics">
                            Custom Metrics<a
                              href="#custom-metrics"
                              class="hash-link"
                              aria-label="Custom Metrics에 대한 직접 링크"
                              title="Custom Metrics에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <div
                            class="language-typescript codeBlockContainer_Ckt0 theme-code-block"
                            style="--prism-color: #393a34; --prism-background-color: #f6f8fa"
                          >
                            <div class="codeBlockContent_QJqH">
                              <pre
                                tabindex="0"
                                class="prism-code language-typescript codeBlock_bY9V thin-scrollbar"
                                style="color: #393a34; background-color: #f6f8fa"
                              ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Create custom metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> playersOnline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> metricsServer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createGauge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;players_online&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Number of players currently online&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;server_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Update metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">playersOnline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">labels</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;world-1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">150</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre>
                            </div>
                          </div>
                          <h2
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="admin-panel-integration"
                          >
                            Admin Panel Integration<a
                              href="#admin-panel-integration"
                              class="hash-link"
                              aria-label="Admin Panel Integration에 대한 직접 링크"
                              title="Admin Panel Integration에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ul>
                            <li>
                              Sidebar adds a &quot;Grafana&quot; item under the Admin Panel section.
                            </li>
                            <li>
                              Opens in a new tab and honors <code>VITE_GRAFANA_URL</code> when
                              provided.
                            </li>
                            <li>
                              Localization keys were added in <code>en.json</code>,
                              <code>ko.json</code>, <code>zh.json</code> (checked for duplicates).
                            </li>
                          </ul>
                          <h2
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="how-to-run-localdocker"
                          >
                            How to Run (Local/Docker)<a
                              href="#how-to-run-localdocker"
                              class="hash-link"
                              aria-label="How to Run (Local/Docker)에 대한 직접 링크"
                              title="How to Run (Local/Docker)에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ol>
                            <li>Build the monorepo</li>
                          </ol>
                          <ul>
                            <li>
                              <code>yarn build</code> (or
                              <code
                                >yarn build:backend &amp;&amp; yarn build:frontend &amp;&amp; yarn
                                build:event-lens &amp;&amp; yarn build:chat-server</code
                              >)
                            </li>
                          </ul>
                          <ol start="2">
                            <li>Development stack</li>
                          </ol>
                          <ul>
                            <li>
                              <code>yarn docker:dev</code> to start all dev services (including
                              Prometheus and Grafana)
                            </li>
                            <li>
                              Access Grafana:
                              <a
                                href="http://localhost:44000"
                                target="_blank"
                                rel="noopener noreferrer"
                                >http://localhost:44000</a
                              >
                            </li>
                            <li>
                              Access Prometheus:
                              <a
                                href="http://localhost:49090"
                                target="_blank"
                                rel="noopener noreferrer"
                                >http://localhost:49090</a
                              >
                            </li>
                          </ul>
                          <ol start="3">
                            <li>Production-like stack</li>
                          </ol>
                          <ul>
                            <li>
                              <code>yarn docker:up</code> to start services with production compose
                            </li>
                            <li>
                              Access Grafana:
                              <a
                                href="http://localhost:44000"
                                target="_blank"
                                rel="noopener noreferrer"
                                >http://localhost:44000</a
                              >
                            </li>
                            <li>
                              Access Prometheus:
                              <a
                                href="http://localhost:49090"
                                target="_blank"
                                rel="noopener noreferrer"
                                >http://localhost:49090</a
                              >
                            </li>
                          </ul>
                          <ol start="4">
                            <li>Restart policy</li>
                          </ol>
                          <ul>
                            <li>
                              Please use <code>docker-compose down</code> then <code>up</code> (do
                              not use <code>restart</code>), per team rules.
                            </li>
                          </ul>
                          <h2
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="custom-metrics-guide-preview"
                          >
                            Custom Metrics Guide (Preview)<a
                              href="#custom-metrics-guide-preview"
                              class="hash-link"
                              aria-label="Custom Metrics Guide (Preview)에 대한 직접 링크"
                              title="Custom Metrics Guide (Preview)에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <p>Once <code>prom-client</code> is enabled for Backend/Event Lens:</p>
                          <ul>
                            <li>
                              Counter example:<!-- -->
                              <ul>
                                <li>Name: <code>http_requests_total</code></li>
                                <li>
                                  Labels: <code>method</code>, <code>route</code>,
                                  <code>status</code>
                                </li>
                              </ul>
                            </li>
                            <li>
                              Histogram example:<!-- -->
                              <ul>
                                <li>Name: <code>http_request_duration_seconds</code></li>
                                <li>
                                  Labels: <code>method</code>, <code>route</code>,
                                  <code>status</code>
                                </li>
                              </ul>
                            </li>
                          </ul>
                          <p>Implementation pattern (Node.js/Express):</p>
                          <ul>
                            <li>
                              Initialize metrics registry on app start when
                              <code>MONITORING_ENABLED=true</code>.
                            </li>
                            <li>
                              Expose <code>/metrics</code> endpoint returning
                              <code>text/plain; version=0.0.4</code>.
                            </li>
                            <li>
                              Avoid side effects at import time; initialize explicitly inside a
                              bootstrap function.
                            </li>
                          </ul>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-notes">
                            Security Notes<a
                              href="#security-notes"
                              class="hash-link"
                              aria-label="Security Notes에 대한 직접 링크"
                              title="Security Notes에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ul>
                            <li>
                              Default Grafana admin credentials are <code>admin/admin</code>. Change
                              them via env vars in production.
                            </li>
                            <li>
                              Prometheus UI should be internal-only in production or protected via
                              reverse proxy.
                            </li>
                          </ul>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">
                            Troubleshooting<a
                              href="#troubleshooting"
                              class="hash-link"
                              aria-label="Troubleshooting에 대한 직접 링크"
                              title="Troubleshooting에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <h3 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus-targets">
                            Prometheus Targets<a
                              href="#prometheus-targets"
                              class="hash-link"
                              aria-label="Prometheus Targets에 대한 직접 링크"
                              title="Prometheus Targets에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <ul>
                            <li>
                              Prometheus has a <code>Targets</code> page to verify discovered
                              endpoints.
                            </li>
                            <li>
                              If targets are missing, check the Backend HTTP-SD endpoint and service
                              discovery configuration.
                            </li>
                            <li>Ensure ports do not conflict (Prometheus uses 49090/9090).</li>
                          </ul>
                          <h3
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="host-based-game-server-metrics-docker-environment"
                          >
                            Host-Based Game Server Metrics (Docker Environment)<a
                              href="#host-based-game-server-metrics-docker-environment"
                              class="hash-link"
                              aria-label="Host-Based Game Server Metrics (Docker Environment)에 대한 직접 링크"
                              title="Host-Based Game Server Metrics (Docker Environment)에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <p>
                            When Prometheus runs in Docker but game servers run on the host (via
                            PM2), Prometheus cannot access host IPs directly.
                          </p>
                          <p>
                            <strong>Solution</strong>: The Backend automatically converts host IPs
                            to <code>host.docker.internal</code> for Prometheus targeting.
                          </p>
                          <p><strong>How it works:</strong></p>
                          <ul>
                            <li>
                              The Backend&#x27;s
                              <code>/api/v1/public/monitoring/prometheus/targets</code> endpoint
                              checks if game server IPs are Docker internal (172.x.x.x) or host
                              machine IPs.
                            </li>
                            <li>
                              For host machine IPs, it automatically converts them to
                              <code>host.docker.internal</code>.
                            </li>
                          </ul>
                          <p><strong>Environment Variable:</strong></p>
                          <ul>
                            <li>
                              <code>PROMETHEUS_IN_DOCKER</code> (default: <code>true</code>):
                              Controls whether host IPs should be converted to
                              <code>host.docker.internal</code>.<!-- -->
                              <ul>
                                <li>
                                  <code>true</code> (default): Prometheus runs in Docker, convert
                                  host IPs to <code>host.docker.internal</code>
                                </li>
                                <li>
                                  <code>false</code>: Prometheus runs externally (e.g., on host or
                                  separate machine), use actual IP addresses
                                </li>
                              </ul>
                            </li>
                          </ul>
                          <p>
                            <strong>Docker Configuration:</strong> Add to
                            <code>docker-compose.yml</code> (prometheus service):
                          </p>
                          <div
                            class="language-yaml codeBlockContainer_Ckt0 theme-code-block"
                            style="--prism-color: #393a34; --prism-background-color: #f6f8fa"
                          >
                            <div class="codeBlockContent_QJqH">
                              <pre
                                tabindex="0"
                                class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"
                                style="color: #393a34; background-color: #f6f8fa"
                              ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">extra_hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;host.docker.internal:host-gateway&quot;</span><br></span></code></pre>
                            </div>
                          </div>
                          <p>
                            <strong>When to set <code>PROMETHEUS_IN_DOCKER=false</code>:</strong>
                          </p>
                          <ul>
                            <li>Prometheus runs directly on host machine (not in Docker)</li>
                            <li>Prometheus runs on a separate monitoring server</li>
                            <li>Using Kubernetes with proper network policies</li>
                          </ul>
                          <h3
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="grafana-logs-dashboard-not-showing-all-log-levels"
                          >
                            Grafana Logs Dashboard Not Showing All Log Levels<a
                              href="#grafana-logs-dashboard-not-showing-all-log-levels"
                              class="hash-link"
                              aria-label="Grafana Logs Dashboard Not Showing All Log Levels에 대한 직접 링크"
                              title="Grafana Logs Dashboard Not Showing All Log Levels에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <p>
                            If the Grafana Logs dashboard only shows <code>info</code> logs even
                            when <code>level=All</code> is selected:
                          </p>
                          <p>
                            <strong>Root Cause</strong>: Loki requires labels in stream selectors to
                            <strong>exist</strong> on log lines. If <code>externalIp</code> or
                            <code>internalIp</code> labels are missing from some logs (e.g., error
                            logs), those logs are filtered out.
                          </p>
                          <p><strong>Solution</strong>:</p>
                          <ol>
                            <li>
                              <p>
                                Move optional labels (<code>internalIp</code>,
                                <code>externalIp</code>) from <strong>stream selector</strong> to
                                <strong>log pipeline filter</strong>:
                              </p>
                              <ul>
                                <li>
                                  Before:
                                  <code
                                    >{job=&quot;gatrix&quot;, level=~&quot;$level&quot;,
                                    internalIp=~&quot;...&quot;, externalIp=~&quot;...&quot;}</code
                                  >
                                </li>
                                <li>
                                  After:
                                  <code
                                    >{job=&quot;gatrix&quot;, level=~&quot;$level&quot;} | json |
                                    internalIp=~&quot;...&quot; | externalIp=~&quot;...&quot;</code
                                  >
                                </li>
                              </ul>
                            </li>
                            <li>
                              <p>
                                Add <code>allValue: &quot;.*&quot;</code> to all multi-select
                                variables in the dashboard JSON:
                              </p>
                              <div
                                class="language-json codeBlockContainer_Ckt0 theme-code-block"
                                style="--prism-color: #393a34; --prism-background-color: #f6f8fa"
                              >
                                <div class="codeBlockContent_QJqH">
                                  <pre
                                    tabindex="0"
                                    class="prism-code language-json codeBlock_bY9V thin-scrollbar"
                                    style="color: #393a34; background-color: #f6f8fa"
                                  ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;service&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;includeAll&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;allValue&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;multi&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre>
                                </div>
                              </div>
                            </li>
                            <li>
                              <p>Restart Grafana: <code>docker restart gatrix-grafana-dev</code></p>
                            </li>
                          </ol>
                          <h2 class="anchor anchorWithStickyNavbar_LWe7" id="internationalization">
                            Internationalization<a
                              href="#internationalization"
                              class="hash-link"
                              aria-label="Internationalization에 대한 직접 링크"
                              title="Internationalization에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <ul>
                            <li>
                              All UI labels for the Grafana menu item are localized (ko/en/zh).
                            </li>
                            <li>
                              When adding new guidance strings, ensure localization keys are unique
                              and friendly (Korean guidelines ending with &quot;...?�니??&quot;).
                            </li>
                          </ul>
                          <h2
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="loki-direct-log-push-sdk"
                          >
                            Loki Direct Log Push (SDK)<a
                              href="#loki-direct-log-push-sdk"
                              class="hash-link"
                              aria-label="Loki Direct Log Push (SDK)에 대한 직접 링크"
                              title="Loki Direct Log Push (SDK)에 대한 직접 링크"
                              >​</a
                            >
                          </h2>
                          <p>
                            Game servers and services now push logs directly to Loki using the
                            <code>@gatrix/server-sdk</code>. This modern approach replaces
                            file-based scraping (Promtail), providing better performance, structured
                            data, and simplified deployment.
                          </p>
                          <h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">
                            How it Works<a
                              href="#how-it-works"
                              class="hash-link"
                              aria-label="How it Works에 대한 직접 링크"
                              title="How it Works에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <ol>
                            <li>
                              <strong>SDK Logger</strong>: The SDK includes a
                              <code>LokiTransport</code> that batches log entries and sends them via
                              HTTP POST to the Loki push API.
                            </li>
                            <li>
                              <strong>SDK Manager Integration</strong>: The
                              <code>gatrixSdkManager.ts</code> initializes the SDK with Loki
                              settings from <code>mconf</code>.
                            </li>
                            <li>
                              <strong>mlog Hooking</strong>: After SDK initialization, the
                              SDK&#x27;s logger is injected into the game&#x27;s global
                              <code>mlog</code> instance. All logs sent through
                              <code>mlog</code> (info, error, etc.) are automatically forwarded to
                              Loki.
                            </li>
                            <li>
                              <strong>Automatic Labeling</strong>: Logs are automatically tagged
                              with metadata: <code>service</code>, <code>group</code>,
                              <code>environment</code>, <code>application</code>, and
                              <code>hostname</code>.
                            </li>
                          </ol>
                          <h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">
                            Configuration<a
                              href="#configuration"
                              class="hash-link"
                              aria-label="Configuration에 대한 직접 링크"
                              title="Configuration에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <p>
                            Loki can be enabled and configured in <code>mconf.ts</code> or via
                            <code>default.json5</code>:
                          </p>
                          <div
                            class="language-json5 codeBlockContainer_Ckt0 theme-code-block"
                            style="--prism-color: #393a34; --prism-background-color: #f6f8fa"
                          >
                            <div class="codeBlockContent_QJqH">
                              <pre
                                tabindex="0"
                                class="prism-code language-json5 codeBlock_bY9V thin-scrollbar"
                                style="color: #393a34; background-color: #f6f8fa"
                              ><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gatrix: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loki: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Enable/disable direct Loki logging */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Loki push API URL */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url: &quot;http://localhost:43100/loki/api/v1/push&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Optional additional labels */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source_category: &quot;game-server&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Maximum number of log entries per batch (default: 1000) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    batchSize: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Maximum interval between batches in ms (default: 5000) */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    batchInterval: 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre>
                            </div>
                          </div>
                          <h3
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="environment-variables-1"
                          >
                            Environment Variables<a
                              href="#environment-variables-1"
                              class="hash-link"
                              aria-label="Environment Variables에 대한 직접 링크"
                              title="Environment Variables에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <p>
                            While configuration via <code>mconf</code> is preferred, the SDK also
                            supports automatic activation via environment variables for non-game
                            services:
                          </p>
                          <ul>
                            <li>
                              <code>GATRIX_LOKI_ENABLED</code>: Set to <code>true</code> to enable.
                            </li>
                            <li><code>GATRIX_LOKI_URL</code>: Loki push endpoint.</li>
                          </ul>
                          <h3
                            class="anchor anchorWithStickyNavbar_LWe7"
                            id="migration-from-promtail"
                          >
                            Migration from Promtail<a
                              href="#migration-from-promtail"
                              class="hash-link"
                              aria-label="Migration from Promtail에 대한 직접 링크"
                              title="Migration from Promtail에 대한 직접 링크"
                              >​</a
                            >
                          </h3>
                          <p>
                            Promtail is no longer required for game server log collection. All
                            relevant <code>docker-compose</code> services and documentation have
                            been updated to reflect this change. Host-based PM2 logs are now
                            natively pushed by the application process itself.
                          </p>
                        </div>
                        <footer class="theme-doc-footer docusaurus-mt-lg">
                          <div class="row margin-top--sm theme-doc-footer-edit-meta-row">
                            <div class="col">
                              <a
                                href="https://github.com/your-org/gatrix/tree/main/docs/docs/features/monitoring.md"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="theme-edit-this-page"
                                ><svg
                                  fill="currentColor"
                                  height="20"
                                  width="20"
                                  viewBox="0 0 40 40"
                                  class="iconEdit_Z9Sw"
                                  aria-hidden="true"
                                >
                                  <g>
                                    <path
                                      d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"
                                    ></path>
                                  </g></svg
                                >페이지 편집</a
                              >
                            </div>
                            <div class="col lastUpdated_JAkA"></div>
                          </div>
                        </footer>
                      </article>
                      <nav class="docusaurus-mt-lg pagination-nav" aria-label="문서 페이지"></nav>
                    </div>
                  </div>
                  <div class="col col--3">
                    <div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop">
                      <ul class="table-of-contents table-of-contents__left-border">
                        <li>
                          <a href="#overview" class="table-of-contents__link toc-highlight"
                            >Overview</a
                          >
                        </li>
                        <li>
                          <a href="#architecture" class="table-of-contents__link toc-highlight"
                            >Architecture</a
                          >
                        </li>
                        <li>
                          <a href="#ports" class="table-of-contents__link toc-highlight">Ports</a>
                        </li>
                        <li>
                          <a
                            href="#environment-variables"
                            class="table-of-contents__link toc-highlight"
                            >Environment Variables</a
                          >
                        </li>
                        <li>
                          <a href="#docker-compose" class="table-of-contents__link toc-highlight"
                            >Docker Compose</a
                          >
                        </li>
                        <li>
                          <a
                            href="#backend-http-sd-endpoint"
                            class="table-of-contents__link toc-highlight"
                            >Backend HTTP-SD Endpoint</a
                          >
                        </li>
                        <li>
                          <a
                            href="#enabling-metrics-per-service"
                            class="table-of-contents__link toc-highlight"
                            >Enabling Metrics Per Service</a
                          >
                        </li>
                        <li>
                          <a
                            href="#sdk-metrics-server"
                            class="table-of-contents__link toc-highlight"
                            >SDK Metrics Server</a
                          >
                          <ul>
                            <li>
                              <a href="#quick-setup" class="table-of-contents__link toc-highlight"
                                >Quick Setup</a
                              >
                            </li>
                            <li>
                              <a
                                href="#default-labels"
                                class="table-of-contents__link toc-highlight"
                                >Default Labels</a
                              >
                            </li>
                            <li>
                              <a
                                href="#service-discovery-integration"
                                class="table-of-contents__link toc-highlight"
                                >Service Discovery Integration</a
                              >
                            </li>
                            <li>
                              <a
                                href="#custom-metrics"
                                class="table-of-contents__link toc-highlight"
                                >Custom Metrics</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            href="#admin-panel-integration"
                            class="table-of-contents__link toc-highlight"
                            >Admin Panel Integration</a
                          >
                        </li>
                        <li>
                          <a
                            href="#how-to-run-localdocker"
                            class="table-of-contents__link toc-highlight"
                            >How to Run (Local/Docker)</a
                          >
                        </li>
                        <li>
                          <a
                            href="#custom-metrics-guide-preview"
                            class="table-of-contents__link toc-highlight"
                            >Custom Metrics Guide (Preview)</a
                          >
                        </li>
                        <li>
                          <a href="#security-notes" class="table-of-contents__link toc-highlight"
                            >Security Notes</a
                          >
                        </li>
                        <li>
                          <a href="#troubleshooting" class="table-of-contents__link toc-highlight"
                            >Troubleshooting</a
                          >
                          <ul>
                            <li>
                              <a
                                href="#prometheus-targets"
                                class="table-of-contents__link toc-highlight"
                                >Prometheus Targets</a
                              >
                            </li>
                            <li>
                              <a
                                href="#host-based-game-server-metrics-docker-environment"
                                class="table-of-contents__link toc-highlight"
                                >Host-Based Game Server Metrics (Docker Environment)</a
                              >
                            </li>
                            <li>
                              <a
                                href="#grafana-logs-dashboard-not-showing-all-log-levels"
                                class="table-of-contents__link toc-highlight"
                                >Grafana Logs Dashboard Not Showing All Log Levels</a
                              >
                            </li>
                          </ul>
                        </li>
                        <li>
                          <a
                            href="#internationalization"
                            class="table-of-contents__link toc-highlight"
                            >Internationalization</a
                          >
                        </li>
                        <li>
                          <a
                            href="#loki-direct-log-push-sdk"
                            class="table-of-contents__link toc-highlight"
                            >Loki Direct Log Push (SDK)</a
                          >
                          <ul>
                            <li>
                              <a href="#how-it-works" class="table-of-contents__link toc-highlight"
                                >How it Works</a
                              >
                            </li>
                            <li>
                              <a href="#configuration" class="table-of-contents__link toc-highlight"
                                >Configuration</a
                              >
                            </li>
                            <li>
                              <a
                                href="#environment-variables-1"
                                class="table-of-contents__link toc-highlight"
                                >Environment Variables</a
                              >
                            </li>
                            <li>
                              <a
                                href="#migration-from-promtail"
                                class="table-of-contents__link toc-highlight"
                                >Migration from Promtail</a
                              >
                            </li>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </main>
          </div>
        </div>
      </div>
      <footer class="theme-layout-footer footer footer--dark">
        <div class="container container-fluid">
          <div class="row footer__links">
            <div class="theme-layout-footer-column col footer__col">
              <div class="footer__title">Documentation</div>
              <ul class="footer__items clean-list">
                <li class="footer__item">
                  <a class="footer__link-item" href="/docs/ko/intro">Getting Started</a>
                </li>
                <li class="footer__item">
                  <a class="footer__link-item" href="/docs/ko/api/client-api">API Reference</a>
                </li>
                <li class="footer__item">
                  <a class="footer__link-item" href="/docs/ko/backend/cache-keys">Cache System</a>
                </li>
              </ul>
            </div>
            <div class="theme-layout-footer-column col footer__col">
              <div class="footer__title">Community</div>
              <ul class="footer__items clean-list">
                <li class="footer__item">
                  <a
                    href="https://github.com/your-org/gatrix/issues"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="footer__link-item"
                    >GitHub Issues<svg
                      width="13.5"
                      height="13.5"
                      aria-hidden="true"
                      class="iconExternalLink_nPIU"
                    >
                      <use href="#theme-svg-external-link"></use></svg
                  ></a>
                </li>
                <li class="footer__item">
                  <a
                    href="https://github.com/your-org/gatrix/discussions"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="footer__link-item"
                    >GitHub Discussions<svg
                      width="13.5"
                      height="13.5"
                      aria-hidden="true"
                      class="iconExternalLink_nPIU"
                    >
                      <use href="#theme-svg-external-link"></use></svg
                  ></a>
                </li>
              </ul>
            </div>
            <div class="theme-layout-footer-column col footer__col">
              <div class="footer__title">More</div>
              <ul class="footer__items clean-list">
                <li class="footer__item">
                  <a class="footer__link-item" href="/docs/ko/blog">Blog</a>
                </li>
                <li class="footer__item">
                  <a
                    href="https://github.com/your-org/gatrix"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="footer__link-item"
                    >GitHub<svg
                      width="13.5"
                      height="13.5"
                      aria-hidden="true"
                      class="iconExternalLink_nPIU"
                    >
                      <use href="#theme-svg-external-link"></use></svg
                  ></a>
                </li>
              </ul>
            </div>
          </div>
          <div class="footer__bottom text--center">
            <div class="footer__copyright">Copyright © 2026 Gatrix. Built with Docusaurus.</div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
