<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-features/feature-flags" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">功能标志 | Gatrix Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://gatrix-docs.example.com/docs/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://gatrix-docs.example.com/docs/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://gatrix-docs.example.com/docs/zh-Hans/features/feature-flags"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="ko_KR"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="功能标志 | Gatrix Documentation"><meta data-rh="true" name="description" content="利用功能标志实现安全部署，支持实时切换、环境定向、分段发布和多平台 SDK。"><meta data-rh="true" property="og:description" content="利用功能标志实现安全部署，支持实时切换、环境定向、分段发布和多平台 SDK。"><link data-rh="true" rel="icon" href="/docs/zh-Hans/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://gatrix-docs.example.com/docs/zh-Hans/features/feature-flags"><link data-rh="true" rel="alternate" href="https://gatrix-docs.example.com/docs/features/feature-flags" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://gatrix-docs.example.com/docs/ko/features/feature-flags" hreflang="ko-KR"><link data-rh="true" rel="alternate" href="https://gatrix-docs.example.com/docs/zh-Hans/features/feature-flags" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://gatrix-docs.example.com/docs/features/feature-flags" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"功能标志","item":"https://gatrix-docs.example.com/docs/zh-Hans/features/feature-flags"}]}</script><link rel="alternate" type="application/rss+xml" href="/docs/zh-Hans/blog/rss.xml" title="Gatrix Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/zh-Hans/blog/atom.xml" title="Gatrix Documentation Atom Feed"><link rel="stylesheet" href="/docs/zh-Hans/assets/css/styles.7af99d74.css">
<script src="/docs/zh-Hans/assets/js/runtime~main.2ee10953.js" defer="defer"></script>
<script src="/docs/zh-Hans/assets/js/main.7f8c8098.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/docs/zh-Hans/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/zh-Hans/"><div class="navbar__logo"><img src="/docs/zh-Hans/img/logo.svg" alt="Gatrix Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/zh-Hans/img/logo.svg" alt="Gatrix Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Gatrix</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/zh-Hans/intro">Documentation</a><a class="navbar__item navbar__link" href="/docs/zh-Hans/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/features/feature-flags" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/docs/ko/features/feature-flags" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ko-KR">한국어</a></li><li><a href="/docs/zh-Hans/features/feature-flags" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">简体中文</a></li></ul></div><a href="https://github.com/your-org/gatrix" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-Hans/intro">Gatrix 简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/zh-Hans/getting-started/quick-start">入门指南</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-Hans/getting-started/quick-start">快速入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-Hans/getting-started/installation">安装指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-Hans/getting-started/configuration">配置指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/zh-Hans/features/feature-flags">功能开关</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/zh-Hans/features/feature-flags">功能标志</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-Hans/features/segments">受众群组</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-Hans/features/environments">环境管理</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/zh-Hans/guide/service-notices">游戏运营</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/zh-Hans/admin/maintenance">系统管理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/zh-Hans/integrations/overview">外部集成</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/zh-Hans/sdks/server-side">SDKs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/zh-Hans/api/client-api">API 参考</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/zh-Hans/deployment/docker">部署指南</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/docs/zh-Hans/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">功能开关</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">功能标志</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>功能标志</h1></header>
<p>利用功能标志实现安全部署，支持实时切换、环境定向、分段发布和多平台 SDK。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h2>
<p>Gatrix 功能标志允许您无需代码部署即可控制功能的可用性。标志以<strong>全局</strong>方式定义，可以拥有<strong>按环境</strong>设置（启用/禁用、值覆盖）。评估在<strong>服务器端</strong>执行 — 客户端 SDK 发送上下文，接收预评估结果，并在本地缓存以实现零延迟读取。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="核心功能">核心功能<a href="#核心功能" class="hash-link" aria-label="核心功能的直接链接" title="核心功能的直接链接">​</a></h3>
<ul>
<li><strong>实时切换</strong> — 即时在所有连接的客户端上启用/禁用功能</li>
<li><strong>环境定向</strong> — 按环境启用/禁用及值覆盖 (development, staging, production)</li>
<li><strong>分段定向</strong> — 基于上下文约束的可复用用户组</li>
<li><strong>策略发布</strong> — 通过百分比、分段约束和粘性进行渐进式发布</li>
<li><strong>多平台 SDK</strong> — JavaScript/TypeScript、Unity (C#)、Unreal Engine (C++)、Cocos2d-x (C++)、Flutter (Dart)、Godot (GDScript)、Python</li>
<li><strong>曝光追踪</strong> — 监控标志访问以进行分析</li>
<li><strong>显式同步模式</strong> — 缓冲标志变更并在受控同步点应用（对游戏至关重要）</li>
<li><strong>代码引用</strong> — 通过静态分析追踪代码库中的标志使用情况</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="架构">架构<a href="#架构" class="hash-link" aria-label="架构的直接链接" title="架构的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="评估模型">评估模型<a href="#评估模型" class="hash-link" aria-label="评估模型的直接链接" title="评估模型的直接链接">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────┐         ┌──────────────────┐         ┌──────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   Client SDK       │─context─▶   Edge API       │─eval──▶ │  Evaluator   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   (cache + poll)   │◀─result─│   (or Backend)   │◀───────│  (shared)    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────┘         └──────────────────┘         └──────────────┘</span><br></span></code></pre></div></div>
<ol>
<li>客户端 SDK 将<strong>上下文</strong> (userId, sessionId, properties) 发送到 Edge API</li>
<li>服务器使用<strong>策略</strong>、<strong>约束</strong>和<strong>分段</strong>评估所有标志</li>
<li>预评估结果返回给客户端</li>
<li>客户端在本地缓存结果以实现零延迟读取</li>
<li>SDK 定期轮询（默认：30秒）获取更新</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="核心设计原则">核心设计原则<a href="#核心设计原则" class="hash-link" aria-label="核心设计原则的直接链接" title="核心设计原则的直接链接">​</a></h3>
<ul>
<li><strong>标志是全局的</strong> — 标志只定义一次，不按环境定义</li>
<li><strong>环境控制激活</strong> — 每个环境有自己的 <code>isEnabled</code>、<code>enabledValue</code>、<code>disabledValue</code> 覆盖</li>
<li><strong>策略按环境配置</strong> — 定向规则按环境配置</li>
<li><strong>变体按环境配置</strong> — A/B 测试分配可以在不同环境间有所不同</li>
<li><strong>分段是全局的</strong> — 可在所有标志和环境中复用</li>
<li><strong><code>isArchived</code> 仅用于管理</strong> — 归档的标志仍正常评估；归档是 UI/治理概念</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建功能标志">创建功能标志<a href="#创建功能标志" class="hash-link" aria-label="创建功能标志的直接链接" title="创建功能标志的直接链接">​</a></h2>
<ol>
<li>在管理控制台导航到 <strong>Feature Flags</strong></li>
<li>点击 <strong>Create Flag</strong></li>
<li>配置标志：</li>
</ol>
<table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>键 (<code>flagName</code>)</td><td>文本</td><td>✅</td><td>唯一标识符（例如：<code>new-checkout-flow</code>）</td></tr><tr><td>显示名称</td><td>文本</td><td>✅</td><td>人类可读的显示名称</td></tr><tr><td>说明</td><td>文本域</td><td>—</td><td>用途和上下文描述</td></tr><tr><td>标志类型 (<code>flagType</code>)</td><td>选择</td><td>✅</td><td>用途分类（见下文）</td></tr><tr><td>值类型 (<code>valueType</code>)</td><td>选择</td><td>✅</td><td><code>boolean</code>, <code>string</code>, <code>number</code>, <code>json</code></td></tr><tr><td>启用值</td><td>动态</td><td>✅</td><td>标志评估为启用时返回的值</td></tr><tr><td>禁用值</td><td>动态</td><td>✅</td><td>标志评估为禁用时返回的值</td></tr><tr><td>曝光数据</td><td>开关</td><td>—</td><td>为此标志启用曝光追踪</td></tr><tr><td>过期天数</td><td>数字</td><td>—</td><td>超过此天数后标志被视为过期</td></tr><tr><td>标签</td><td>标签</td><td>—</td><td>分类标签</td></tr></tbody></table>
<ol start="4">
<li>点击 <strong>Create</strong></li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>标志键命名</div><div class="admonitionContent_BuS1"><p>使用 <strong>kebab-case</strong> 命名标志键：<code>dark-mode</code>、<code>new-checkout-flow</code>、<code>max-retry-count</code>。
标志键区分大小写。在代码中使用字符串字面量以兼容静态分析。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="标志类型用途">标志类型（用途）<a href="#标志类型用途" class="hash-link" aria-label="标志类型（用途）的直接链接" title="标志类型（用途）的直接链接">​</a></h3>
<p>标志类型描述标志的<strong>用途</strong>，而非数据类型：</p>
<table><thead><tr><th>标志类型</th><th>说明</th></tr></thead><tbody><tr><td><code>release</code></td><td>控制功能向用户的发布</td></tr><tr><td><code>experiment</code></td><td>A/B 测试和实验</td></tr><tr><td><code>operational</code></td><td>运营控制（速率限制、断路器）</td></tr><tr><td><code>killSwitch</code></td><td>紧急禁用功能的开关</td></tr><tr><td><code>permission</code></td><td>基于用户属性的访问控制</td></tr><tr><td><code>remoteConfig</code></td><td>远程配置值（游戏平衡、UI 设置等）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="值类型">值类型<a href="#值类型" class="hash-link" aria-label="值类型的直接链接" title="值类型的直接链接">​</a></h3>
<table><thead><tr><th>值类型</th><th>说明</th><th>默认回退</th><th>示例</th></tr></thead><tbody><tr><td><code>boolean</code></td><td>真/假切换</td><td><code>false</code></td><td><code>true</code></td></tr><tr><td><code>string</code></td><td>文本值</td><td><code>&quot;&quot;</code></td><td><code>&quot;dark-theme&quot;</code></td></tr><tr><td><code>number</code></td><td>数值</td><td><code>0</code></td><td><code>100</code></td></tr><tr><td><code>json</code></td><td>复杂对象</td><td><code>{}</code></td><td><code>{ &quot;limit&quot;: 10, &quot;theme&quot;: &quot;modern&quot; }</code></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="按环境设置">按环境设置<a href="#按环境设置" class="hash-link" aria-label="按环境设置的直接链接" title="按环境设置的直接链接">​</a></h2>
<p>每个标志可以在不同环境中有不同的设置：</p>
<table><thead><tr><th>设置</th><th>说明</th></tr></thead><tbody><tr><td><code>isEnabled</code></td><td>此环境中标志是否激活</td></tr><tr><td><code>enabledValue</code></td><td>覆盖全局启用值（可选）</td></tr><tr><td><code>disabledValue</code></td><td>覆盖全局禁用值（可选）</td></tr><tr><td><code>strategies</code></td><td>此环境特定的定向规则</td></tr><tr><td><code>variants</code></td><td>此环境特定的变体分配</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例按环境设置">示例：按环境设置<a href="#示例按环境设置" class="hash-link" aria-label="示例：按环境设置的直接链接" title="示例：按环境设置的直接链接">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Flag: &quot;new-checkout-flow&quot; (boolean)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Global: enabledValue=true, disabledValue=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── development: isEnabled=true  (无策略 → 始终启用)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── staging:     isEnabled=true  (策略: userId IN [&quot;tester-1&quot;, &quot;tester-2&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── production:  isEnabled=true  (策略: rollout 10%, stickiness=userId)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="策略">策略<a href="#策略" class="hash-link" aria-label="策略的直接链接" title="策略的直接链接">​</a></h2>
<p>策略是<strong>按环境</strong>的定向规则，决定哪些用户接收启用值。策略按 <code>sortOrder</code> 评估。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="策略评估流程">策略评估流程<a href="#策略评估流程" class="hash-link" aria-label="策略评估流程的直接链接" title="策略评估流程的直接链接">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">标志 isEnabled?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├─ NO  → 返回 disabledValue (reason: &quot;disabled&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └─ YES → 存在活跃策略?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ├─ NO  → 返回 enabledValue (reason: &quot;default&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       └─ YES → 对每个策略（按 sortOrder）：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            1. 检查分段约束（全部必须通过）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2. 检查策略约束（全部必须通过）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            3. 检查发布百分比</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └─ 全部通过 → 返回 enabledValue (reason: &quot;strategy_match&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       └─ 无策略匹配 → 返回 disabledValue (reason: &quot;default&quot;)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="策略参数">策略参数<a href="#策略参数" class="hash-link" aria-label="策略参数的直接链接" title="策略参数的直接链接">​</a></h3>
<table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>rollout</code></td><td>number</td><td>接收启用值的用户百分比（0–100）</td></tr><tr><td><code>stickiness</code></td><td>string</td><td>一致性分桶的上下文字段（<code>userId</code>、<code>sessionId</code>、<code>random</code> 或自定义）</td></tr><tr><td><code>groupId</code></td><td>string</td><td>发布分桶的组标识符（默认：标志名称）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="发布分桶">发布分桶<a href="#发布分桶" class="hash-link" aria-label="发布分桶的直接链接" title="发布分桶的直接链接">​</a></h3>
<p>发布使用 <strong>MurmurHash v3</strong> 进行确定性分桶：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">seed = &quot;{groupId}:{stickinessValue}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hash = murmurhash_v3(seed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">percentage = (hash % 10000) / 100   // 0.00 ~ 99.99</span><br></span></code></pre></div></div>
<p>这确保：</p>
<ul>
<li>同一用户对同一标志始终获得相同结果</li>
<li>用户间均匀分布</li>
<li>增加发布百分比时不会重新分桶现有用户</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="约束">约束<a href="#约束" class="hash-link" aria-label="约束的直接链接" title="约束的直接链接">​</a></h2>
<p>约束是策略匹配必须满足的条件。策略内所有约束使用 <strong>AND</strong> 逻辑（全部必须通过）。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="约束结构">约束结构<a href="#约束结构" class="hash-link" aria-label="约束结构的直接链接" title="约束结构的直接链接">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">Constraint</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  contextName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// 要检查的上下文字段（例如：&quot;userId&quot;、&quot;country&quot;）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  operator</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ConstraintOperator</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// 单值运算符用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  values</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 多值运算符用（IN 等）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  caseInsensitive</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 字符串比较大小写敏感性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inverted</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// 反转结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="按类型分类的运算符">按类型分类的运算符<a href="#按类型分类的运算符" class="hash-link" aria-label="按类型分类的运算符的直接链接" title="按类型分类的运算符的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="字符串运算符">字符串运算符<a href="#字符串运算符" class="hash-link" aria-label="字符串运算符的直接链接" title="字符串运算符的直接链接">​</a></h4>
<table><thead><tr><th>运算符</th><th>说明</th><th>值类型</th><th>示例</th></tr></thead><tbody><tr><td><code>str_eq</code></td><td>等于</td><td>单值</td><td><code>country str_eq &quot;KR&quot;</code></td></tr><tr><td><code>str_contains</code></td><td>包含子字符串</td><td>单值</td><td><code>email str_contains &quot;@company.com&quot;</code></td></tr><tr><td><code>str_starts_with</code></td><td>以前缀开头</td><td>单值</td><td><code>userId str_starts_with &quot;test_&quot;</code></td></tr><tr><td><code>str_ends_with</code></td><td>以后缀结尾</td><td>单值</td><td><code>email str_ends_with &quot;.kr&quot;</code></td></tr><tr><td><code>str_in</code></td><td>在列表中</td><td>多值</td><td><code>country str_in [&quot;KR&quot;, &quot;JP&quot;, &quot;US&quot;]</code></td></tr><tr><td><code>str_regex</code></td><td>匹配正则表达式</td><td>单值</td><td><code>email str_regex &quot;^admin@.*&quot;</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="数字运算符">数字运算符<a href="#数字运算符" class="hash-link" aria-label="数字运算符的直接链接" title="数字运算符的直接链接">​</a></h4>
<table><thead><tr><th>运算符</th><th>说明</th><th>值类型</th><th>示例</th></tr></thead><tbody><tr><td><code>num_eq</code></td><td>等于</td><td>单值</td><td><code>level num_eq 10</code></td></tr><tr><td><code>num_gt</code></td><td>大于</td><td>单值</td><td><code>level num_gt 50</code></td></tr><tr><td><code>num_gte</code></td><td>大于等于</td><td>单值</td><td><code>level num_gte 50</code></td></tr><tr><td><code>num_lt</code></td><td>小于</td><td>单值</td><td><code>age num_lt 18</code></td></tr><tr><td><code>num_lte</code></td><td>小于等于</td><td>单值</td><td><code>age num_lte 18</code></td></tr><tr><td><code>num_in</code></td><td>在列表中</td><td>多值</td><td><code>level num_in [1, 5, 10]</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="布尔运算符">布尔运算符<a href="#布尔运算符" class="hash-link" aria-label="布尔运算符的直接链接" title="布尔运算符的直接链接">​</a></h4>
<table><thead><tr><th>运算符</th><th>说明</th><th>值类型</th><th>示例</th></tr></thead><tbody><tr><td><code>bool_is</code></td><td>是真/假</td><td>单值</td><td><code>isPremium bool_is true</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="日期运算符">日期运算符<a href="#日期运算符" class="hash-link" aria-label="日期运算符的直接链接" title="日期运算符的直接链接">​</a></h4>
<table><thead><tr><th>运算符</th><th>说明</th><th>值类型</th><th>示例</th></tr></thead><tbody><tr><td><code>date_eq</code></td><td>等于</td><td>单值</td><td><code>registerDate date_eq &quot;2025-01-01&quot;</code></td></tr><tr><td><code>date_gt</code></td><td>在之后</td><td>单值</td><td><code>registerDate date_gt &quot;2025-01-01&quot;</code></td></tr><tr><td><code>date_gte</code></td><td>在之后(含)</td><td>单值</td><td><code>registerDate date_gte &quot;2025-01-01&quot;</code></td></tr><tr><td><code>date_lt</code></td><td>在之前</td><td>单值</td><td><code>registerDate date_lt &quot;2025-06-01&quot;</code></td></tr><tr><td><code>date_lte</code></td><td>在之前(含)</td><td>单值</td><td><code>registerDate date_lte &quot;2025-06-01&quot;</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="semver-运算符">Semver 运算符<a href="#semver-运算符" class="hash-link" aria-label="Semver 运算符的直接链接" title="Semver 运算符的直接链接">​</a></h4>
<table><thead><tr><th>运算符</th><th>说明</th><th>值类型</th><th>示例</th></tr></thead><tbody><tr><td><code>semver_eq</code></td><td>等于</td><td>单值</td><td><code>appVersion semver_eq &quot;2.0.0&quot;</code></td></tr><tr><td><code>semver_gt</code></td><td>大于</td><td>单值</td><td><code>appVersion semver_gt &quot;1.5.0&quot;</code></td></tr><tr><td><code>semver_gte</code></td><td>大于等于</td><td>单值</td><td><code>appVersion semver_gte &quot;1.5.0&quot;</code></td></tr><tr><td><code>semver_lt</code></td><td>小于</td><td>单值</td><td><code>appVersion semver_lt &quot;3.0.0&quot;</code></td></tr><tr><td><code>semver_lte</code></td><td>小于等于</td><td>单值</td><td><code>appVersion semver_lte &quot;3.0.0&quot;</code></td></tr><tr><td><code>semver_in</code></td><td>在列表中</td><td>多值</td><td><code>appVersion semver_in [&quot;2.0.0&quot;, &quot;2.1.0&quot;]</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="通用运算符类型无关">通用运算符（类型无关）<a href="#通用运算符类型无关" class="hash-link" aria-label="通用运算符（类型无关）的直接链接" title="通用运算符（类型无关）的直接链接">​</a></h4>
<table><thead><tr><th>运算符</th><th>说明</th><th>值类型</th><th>示例</th></tr></thead><tbody><tr><td><code>exists</code></td><td>有值</td><td>无</td><td><code>userId exists</code></td></tr><tr><td><code>not_exists</code></td><td>无值</td><td>无</td><td><code>userId not_exists</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="数组运算符">数组运算符<a href="#数组运算符" class="hash-link" aria-label="数组运算符的直接链接" title="数组运算符的直接链接">​</a></h4>
<table><thead><tr><th>运算符</th><th>说明</th><th>值类型</th><th>示例</th></tr></thead><tbody><tr><td><code>arr_any</code></td><td>包含任一目标值</td><td>多值</td><td><code>tags arr_any [&quot;vip&quot;, &quot;beta&quot;]</code></td></tr><tr><td><code>arr_all</code></td><td>包含所有目标值</td><td>多值</td><td><code>tags arr_all [&quot;vip&quot;, &quot;premium&quot;]</code></td></tr><tr><td><code>arr_empty</code></td><td>数组为空或不存在</td><td>无</td><td><code>tags arr_empty</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="inverted-标志"><code>inverted</code> 标志<a href="#inverted-标志" class="hash-link" aria-label="inverted-标志的直接链接" title="inverted-标志的直接链接">​</a></h3>
<p>每个约束都支持 <code>inverted</code> 布尔值。为 <code>true</code> 时，约束结果被反转：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">str_eq + inverted:true  → 不等于 (≠)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">str_in + inverted:true  → 不在列表中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exists + inverted:true  → 不存在</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="分段">分段<a href="#分段" class="hash-link" aria-label="分段的直接链接" title="分段的直接链接">​</a></h2>
<p>分段是<strong>全局</strong>的可复用约束集合。可以被任何环境中的任何策略引用。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="分段结构">分段结构<a href="#分段结构" class="hash-link" aria-label="分段结构的直接链接" title="分段结构的直接链接">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">FeatureSegment</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  constraints</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Constraint</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 全部必须通过（AND 逻辑）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  isActive</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 仅 UI 显示，不用于评估</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><code>isActive</code> 仅用于 UI</div><div class="admonitionContent_BuS1"><p>分段的 <code>isActive</code> 字段仅控制<strong>管理 UI 中的可见性</strong>。它<strong>不</strong>影响评估。即使非活跃分段在被策略引用时也会正常评估。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建分段">创建分段<a href="#创建分段" class="hash-link" aria-label="创建分段的直接链接" title="创建分段的直接链接">​</a></h3>
<ol>
<li>导航到 <strong>Feature Flags</strong> &gt; <strong>Segments</strong></li>
<li>点击 <strong>Create Segment</strong></li>
<li>定义约束（例如：<code>country str_in [&quot;KR&quot;, &quot;JP&quot;]</code> AND <code>isPremium bool_is true</code>）</li>
<li>保存</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="在策略中使用分段">在策略中使用分段<a href="#在策略中使用分段" class="hash-link" aria-label="在策略中使用分段的直接链接" title="在策略中使用分段的直接链接">​</a></h3>
<p>策略可以引用分段。评估时，分段约束在策略约束<strong>之前</strong>检查：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">策略评估顺序：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. 分段约束（所有引用的分段必须通过）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 策略约束（全部必须通过）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 发布百分比检查</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="上下文">上下文<a href="#上下文" class="hash-link" aria-label="上下文的直接链接" title="上下文的直接链接">​</a></h2>
<p>上下文代表当前用户/会话，驱动所有定向规则。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="评估上下文结构">评估上下文结构<a href="#评估上下文结构" class="hash-link" aria-label="评估上下文结构的直接链接" title="评估上下文结构的直接链接">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">EvaluationContext</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userId</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sessionId</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appName</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appVersion</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remoteAddress</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  currentTime</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  properties</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Record</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="内置上下文字段">内置上下文字段<a href="#内置上下文字段" class="hash-link" aria-label="内置上下文字段的直接链接" title="内置上下文字段的直接链接">​</a></h3>
<table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>userId</code></td><td>string</td><td>唯一用户标识符 — 主要粘性键</td></tr><tr><td><code>sessionId</code></td><td>string</td><td>会话标识符 — 未提供时自动生成</td></tr><tr><td><code>appName</code></td><td>string</td><td>SDK 配置中的应用名称</td></tr><tr><td><code>appVersion</code></td><td>string</td><td>应用版本（支持 semver 比较）</td></tr><tr><td><code>remoteAddress</code></td><td>string</td><td>客户端 IP 地址（评估时由服务器提供）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="自定义上下文字段-properties">自定义上下文字段 (Properties)<a href="#自定义上下文字段-properties" class="hash-link" aria-label="自定义上下文字段 (Properties)的直接链接" title="自定义上下文字段 (Properties)的直接链接">​</a></h3>
<p>自定义属性支持四种类型：</p>
<table><thead><tr><th>类型</th><th>说明</th><th>示例运算符</th></tr></thead><tbody><tr><td><code>string</code></td><td>文本值</td><td><code>str_eq</code>, <code>str_contains</code>, <code>str_in</code>, <code>str_regex</code></td></tr><tr><td><code>number</code></td><td>数值</td><td><code>num_eq</code>, <code>num_gt</code>, <code>num_lt</code>, <code>num_in</code></td></tr><tr><td><code>boolean</code></td><td>真/假值</td><td><code>bool_is</code></td></tr><tr><td><code>array</code></td><td>字符串列表</td><td><code>arr_any</code>, <code>arr_all</code>, <code>arr_empty</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="预定义自定义字段">预定义自定义字段<a href="#预定义自定义字段" class="hash-link" aria-label="预定义自定义字段的直接链接" title="预定义自定义字段的直接链接">​</a></h3>
<p>Gatrix 提供常用的上下文字段：</p>
<table><thead><tr><th>键</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>userLevel</code></td><td>number</td><td>游戏中用户当前等级</td></tr><tr><td><code>country</code></td><td>string</td><td>国家代码 (ISO 3166-1 alpha-2)</td></tr><tr><td><code>platform</code></td><td>string</td><td>设备平台 (ios, android, web, windows, mac, linux)</td></tr><tr><td><code>language</code></td><td>string</td><td>首选语言 (ko, en, ja, zh, ...)</td></tr><tr><td><code>isPremium</code></td><td>boolean</td><td>高级订阅状态</td></tr><tr><td><code>registrationDate</code></td><td>number</td><td>注册后天数</td></tr><tr><td><code>lastLoginDate</code></td><td>number</td><td>上次登录后天数</td></tr><tr><td><code>totalPurchases</code></td><td>number</td><td>总购买金额 (USD)</td></tr><tr><td><code>gameMode</code></td><td>string</td><td>当前游戏模式</td></tr><tr><td><code>tags</code></td><td>array</td><td>分配给用户的自定义标签</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="变体">变体<a href="#变体" class="hash-link" aria-label="变体的直接链接" title="变体的直接链接">​</a></h2>
<p>变体通过加权分配实现 <strong>A/B 测试</strong>。变体按<strong>环境</strong>定义。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="变体结构">变体结构<a href="#变体结构" class="hash-link" aria-label="变体结构的直接链接" title="变体结构的直接链接">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">FeatureVariant</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  variantName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 标志内唯一标识符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  weight</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 分配权重 (0–100)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// 变体特定值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  valueType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ValueType</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 与标志的 valueType 相同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  weightLock</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">boolean</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 重新分配时锁定此变体权重</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="变体选择">变体选择<a href="#变体选择" class="hash-link" aria-label="变体选择的直接链接" title="变体选择的直接链接">​</a></h3>
<p>当标志有变体时，根据用户上下文选择一个：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">percentage = murmurhash_v3(&quot;{flagName}-variant:{stickinessValue}&quot;) % 10000 / 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">累积权重检查：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Variant A (weight: 50) → 0–50%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Variant B (weight: 30) → 50–80%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Variant C (weight: 20) → 80–100%</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="保留变体名称">保留变体名称<a href="#保留变体名称" class="hash-link" aria-label="保留变体名称的直接链接" title="保留变体名称的直接链接">​</a></h3>
<table><thead><tr><th>名称</th><th>含义</th></tr></thead><tbody><tr><td><code>$default</code></td><td>默认变体（未定义变体时）</td></tr><tr><td><code>$disabled</code></td><td>标志已禁用</td></tr><tr><td><code>$missing</code></td><td>缓存中不存在标志</td></tr><tr><td><code>$config</code></td><td>标志使用配置值</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sdk-使用">SDK 使用<a href="#sdk-使用" class="hash-link" aria-label="SDK 使用的直接链接" title="SDK 使用的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="可用客户端-sdk">可用客户端 SDK<a href="#可用客户端-sdk" class="hash-link" aria-label="可用客户端 SDK的直接链接" title="可用客户端 SDK的直接链接">​</a></h3>
<table><thead><tr><th>SDK</th><th>语言</th><th>包名</th></tr></thead><tbody><tr><td><strong>JavaScript/TypeScript</strong></td><td>JS/TS</td><td><code>@gatrix/js-client-sdk</code></td></tr><tr><td><strong>React</strong></td><td>JS/TS</td><td><code>@gatrix/react-sdk</code></td></tr><tr><td><strong>Vue</strong></td><td>JS/TS</td><td><code>@gatrix/vue-sdk</code></td></tr><tr><td><strong>Svelte</strong></td><td>JS/TS</td><td><code>@gatrix/svelte-sdk</code></td></tr><tr><td><strong>Unity</strong></td><td>C#</td><td><code>gatrix-unity-client-sdk</code></td></tr><tr><td><strong>Unreal Engine</strong></td><td>C++</td><td><code>gatrix-unreal-client-sdk</code></td></tr><tr><td><strong>Cocos2d-x</strong></td><td>C++</td><td><code>gatrix-cocos2dx-client-sdk</code></td></tr><tr><td><strong>Flutter</strong></td><td>Dart</td><td><code>gatrix-flutter-client-sdk</code></td></tr><tr><td><strong>Godot</strong></td><td>GDScript</td><td><code>gatrix-godot-client-sdk</code></td></tr><tr><td><strong>Python</strong></td><td>Python</td><td><code>gatrix-python-client-sdk</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sdk-生命周期">SDK 生命周期<a href="#sdk-生命周期" class="hash-link" aria-label="SDK 生命周期的直接链接" title="SDK 生命周期的直接链接">​</a></h3>
<p>所有客户端 SDK 遵循相同的生命周期模式：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Constructor → init() → start() → [polling loop] → stop()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                │          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                │          └─ 首次获取 → &quot;flags.ready&quot; 事件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                └─ 从缓存/引导加载 → &quot;flags.init&quot; 事件</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="初始化">初始化<a href="#初始化" class="hash-link" aria-label="初始化的直接链接" title="初始化的直接链接">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> GatrixClient </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@gatrix/js-client-sdk&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">GatrixClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 必填</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://edge.your-api.com/api/v1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiToken</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;your-client-api-token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;my-app&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;production&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 可选</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  refreshInterval</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 轮询间隔（秒，默认：30）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  explicitSyncMode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 缓冲变更直到 syncFlags()（默认：false）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  disableRefresh</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 禁用自动轮询（默认：false）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  offlineMode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">// 无网络请求（默认：false）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  disableMetrics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 禁用指标收集（默认：false）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 初始上下文</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user-123&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    properties</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      country</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;KR&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      level</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      isPremium</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="标志访问方法">标志访问方法<a href="#标志访问方法" class="hash-link" aria-label="标志访问方法的直接链接" title="标志访问方法的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="基本访问">基本访问<a href="#基本访问" class="hash-link" aria-label="基本访问的直接链接" title="基本访问的直接链接">​</a></h4>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 检查标志是否启用（返回 flag.enabled，非变体值）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> isEnabled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isEnabled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dark-mode&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 检查缓存中是否存在标志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> exists </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasFlag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dark-mode&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 获取所有标志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> allFlags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAllFlags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="类型化变体需要回退值">类型化变体（需要回退值）<a href="#类型化变体需要回退值" class="hash-link" aria-label="类型化变体（需要回退值）的直接链接" title="类型化变体（需要回退值）的直接链接">​</a></h4>
<p>所有 variation 方法<strong>必须</strong>提供回退值。这确保即使在故障期间也能收到有效值。</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 布尔值（来自 variant.value，非 flag.enabled）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> darkMode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">boolVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dark-mode&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 字符串值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> theme </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">stringVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;theme-name&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;light&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 数字值（仅 JS/TS SDK — 见下文说明）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> maxItems </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">numberVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;max-items&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// JSON 值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">jsonVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;feature-config&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> enabled</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span><code>isEnabled()</code> 与 <code>boolVariation()</code></div><div class="admonitionContent_BuS1"><p>这两者有<strong>完全不同</strong>的用途：</p><ul>
<li><strong><code>isEnabled(&#x27;flag&#x27;)</code></strong> → 返回标志是否<strong>已开启</strong> (<code>flag.enabled</code>)</li>
<li><strong><code>boolVariation(&#x27;flag&#x27;, false)</code></strong> → 返回变体的<strong>布尔值</strong> (<code>variant.value</code>)</li>
</ul><p>对于没有变体的简单布尔标志，它们可能返回相同结果，但语义不同。</p></div></div>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>非 JS SDK 的数字类型</div><div class="admonitionContent_BuS1"><p>JavaScript/TypeScript SDK 提供 <code>numberVariation()</code>。</p><p><strong>所有其他 SDK</strong> 使用类型特定的函数：</p><ul>
<li><code>intVariation(flagName, fallbackValue)</code> — 返回整数</li>
<li><code>floatVariation(flagName, fallbackValue)</code> — 返回浮点数</li>
</ul><table><thead><tr><th>SDK</th><th>整数函数</th><th>浮点函数</th></tr></thead><tbody><tr><td>Unity (C#)</td><td><code>IntVariation()</code></td><td><code>FloatVariation()</code></td></tr><tr><td>Unreal</td><td><code>IntVariation()</code></td><td><code>FloatVariation()</code></td></tr><tr><td>Cocos2d-x</td><td><code>intVariation()</code></td><td><code>floatVariation()</code></td></tr><tr><td>Flutter</td><td><code>intVariation()</code></td><td><code>doubleVariation()</code></td></tr><tr><td>Godot</td><td><code>int_variation()</code></td><td><code>float_variation()</code></td></tr><tr><td>Python</td><td><code>int_variation()</code></td><td><code>float_variation()</code></td></tr></tbody></table></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="flagproxy">FlagProxy<a href="#flagproxy" class="hash-link" aria-label="FlagProxy的直接链接" title="FlagProxy的直接链接">​</a></h4>
<p><code>getFlag()</code> 方法返回 <code>FlagProxy</code> — 包含所有 variation 方法的便捷包装器：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> flag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getFlag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dark-mode&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// boolean: 标志是否存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">enabled</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// boolean: 标志是否启用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                      </span><span class="token comment" style="color:#999988;font-style:italic">// string: 标志名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">variant</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// Variant: 永不为 null（使用 $missing 哨兵）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">boolVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 内部委托给 FeaturesClient</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="上下文管理">上下文管理<a href="#上下文管理" class="hash-link" aria-label="上下文管理的直接链接" title="上下文管理的直接链接">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 获取当前上下文</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ctx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 更新整个上下文（触发重新获取）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">updateContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  userId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user-456&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  properties</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> country</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;JP&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 更新单个上下文字段（触发重新获取）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setContextField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 移除上下文字段（触发重新获取）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">removeContextField</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;tempFlag&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>上下文更新性能</div><div class="admonitionContent_BuS1"><p>每次 <code>updateContext()</code> / <code>setContextField()</code> / <code>removeContextField()</code> 调用都会触发<strong>网络请求</strong>以重新评估标志。避免将频繁变化的值放入上下文。</p><p><strong>适合上下文：</strong> userId、country、plan、platform、appVersion
<strong>避免放入上下文：</strong> 时间戳、动画帧、计数器、快速变化的游戏状态</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="watch-模式响应式更新">Watch 模式（响应式更新）<a href="#watch-模式响应式更新" class="hash-link" aria-label="Watch 模式（响应式更新）的直接链接" title="Watch 模式（响应式更新）的直接链接">​</a></h3>
<p>订阅单个标志变更以实现响应式 UI 更新：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 监视标志变更（仅在变更时触发）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> unwatch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">watchFlag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dark-mode&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Dark mode changed:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">boolVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 带初始状态监视（立即以当前值触发，然后在变更时触发）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> unwatch </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">watchFlagWithInitialState</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;dark-mode&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">applyTheme</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">boolVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dark&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;light&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 停止监视</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">unwatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="显式同步模式">显式同步模式<a href="#显式同步模式" class="hash-link" aria-label="显式同步模式的直接链接" title="显式同步模式的直接链接">​</a></h3>
<p>对于标志变更不能中断当前游戏循环或会话的<strong>游戏和实时应用程序</strong>至关重要。</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">GatrixClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  explicitSyncMode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 标志在后台获取但不会应用直到 syncFlags()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;flags.pending_sync&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">showNotification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;有新设置可用！&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 在安全时机应用变更（场景切换、大厅、加载画面）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">syncFlags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="工作原理">工作原理<a href="#工作原理" class="hash-link" aria-label="工作原理的直接链接" title="工作原理的直接链接">​</a></h4>
<table><thead><tr><th>存储</th><th>说明</th></tr></thead><tbody><tr><td><code>realtimeFlags</code></td><td>服务器最新标志（始终最新）</td></tr><tr><td><code>synchronizedFlags</code></td><td>应用读取的标志（通过 syncFlags 更新）</td></tr></tbody></table>
<ul>
<li>默认从 <code>synchronizedFlags</code> 读取</li>
<li>使用 <code>forceRealtime: true</code> 从 <code>realtimeFlags</code> 读取（用于调试 UI）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="事件">事件<a href="#事件" class="hash-link" aria-label="事件的直接链接" title="事件的直接链接">​</a></h3>
<table><thead><tr><th>事件</th><th>说明</th><th>载荷</th></tr></thead><tbody><tr><td><code>flags.init</code></td><td>SDK 从存储/引导初始化</td><td>—</td></tr><tr><td><code>flags.ready</code></td><td>首次获取成功完成</td><td>—</td></tr><tr><td><code>flags.fetch_start</code></td><td>开始获取</td><td><code>{ etag }</code></td></tr><tr><td><code>flags.fetch_success</code></td><td>获取成功</td><td>—</td></tr><tr><td><code>flags.fetch_error</code></td><td>获取失败</td><td><code>{ status?, error? }</code></td></tr><tr><td><code>flags.fetch_end</code></td><td>获取完成（成功或错误）</td><td>—</td></tr><tr><td><code>flags.change</code></td><td>服务器标志变更</td><td><code>{ flags }</code></td></tr><tr><td><code>flags.{name}.change</code></td><td>单个标志变更</td><td><code>(newFlag, oldFlag, changeType)</code></td></tr><tr><td><code>flags.removed</code></td><td>服务器标志移除</td><td><code>string[]</code>（标志名称）</td></tr><tr><td><code>flags.pending_sync</code></td><td>有待同步（显式同步模式）</td><td>—</td></tr><tr><td><code>flags.impression</code></td><td>标志被访问（曝光追踪启用时）</td><td><code>ImpressionEvent</code></td></tr><tr><td><code>flags.error</code></td><td>通用 SDK 错误</td><td><code>{ type, error }</code></td></tr><tr><td><code>flags.recovered</code></td><td>从错误状态恢复</td><td>—</td></tr><tr><td><code>flags.metrics.sent</code></td><td>指标发送成功</td><td><code>{ count }</code></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="轮询和错误恢复">轮询和错误恢复<a href="#轮询和错误恢复" class="hash-link" aria-label="轮询和错误恢复的直接链接" title="轮询和错误恢复的直接链接">​</a></h3>
<table><thead><tr><th>场景</th><th>行为</th></tr></thead><tbody><tr><td>成功获取</td><td><code>refreshInterval</code> 秒后安排下次获取</td></tr><tr><td>可重试错误</td><td>指数退避：<code>min(initialBackoffMs * 2^(n-1), maxBackoffMs)</code></td></tr><tr><td>不可重试 (401, 403)</td><td>轮询停止。手动调用 <code>fetchFlags()</code> 恢复。</td></tr><tr><td>错误后恢复</td><td><code>consecutiveFailures</code> 重置，正常轮询恢复</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="平台示例">平台示例<a href="#平台示例" class="hash-link" aria-label="平台示例的直接链接" title="平台示例的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unity-c">Unity (C#)<a href="#unity-c" class="hash-link" aria-label="Unity (C#)的直接链接" title="Unity (C#)的直接链接">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var config = new GatrixClientConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ApiUrl = &quot;https://edge.your-api.com/api/v1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ApiToken = &quot;your-token&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AppName = &quot;my-game&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment = &quot;production&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExplicitSyncMode = true, // 推荐用于游戏</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var client = new GatrixClient(config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">await client.Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int maxRetries = client.Features.IntVariation(&quot;max-retries&quot;, 3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">float gameSpeed = client.Features.FloatVariation(&quot;game-speed&quot;, 1.0f);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool darkMode = client.Features.BoolVariation(&quot;dark-mode&quot;, false);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unreal-engine-c">Unreal Engine (C++)<a href="#unreal-engine-c" class="hash-link" aria-label="Unreal Engine (C++)的直接链接" title="Unreal Engine (C++)的直接链接">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FGatrixClientConfig Config</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ApiUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://edge.your-api.com/api/v1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ApiToken </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;your-token&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AppName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;my-game&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Environment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;production&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bExplicitSyncMode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TSharedPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FGatrixClient</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">MakeShared</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name">FGatrixClient</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Client</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">Start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> bDarkMode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Client</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetFeatures</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">BoolVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dark-mode&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int32 MaxRetries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Client</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetFeatures</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">IntVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max-retries&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> GameSpeed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Client</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetFeatures</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">FloatVariation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;game-speed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="flutter-dart">Flutter (Dart)<a href="#flutter-dart" class="hash-link" aria-label="Flutter (Dart)的直接链接" title="Flutter (Dart)的直接链接">​</a></h3>
<div class="language-dart codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dart codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">final client = GatrixClient(GatrixClientConfig(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiUrl: &#x27;https://edge.your-api.com/api/v1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiToken: &#x27;your-token&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  appName: &#x27;my-app&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment: &#x27;production&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">await client.start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool darkMode = client.features.boolVariation(&#x27;dark-mode&#x27;, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int maxItems = client.features.intVariation(&#x27;max-items&#x27;, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">double speed = client.features.doubleVariation(&#x27;game-speed&#x27;, 1.0);</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="godot-gdscript">Godot (GDScript)<a href="#godot-gdscript" class="hash-link" aria-label="Godot (GDScript)的直接链接" title="Godot (GDScript)的直接链接">​</a></h3>
<div class="language-gdscript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-gdscript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var config = GatrixClientConfig.new()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.api_url = &quot;https://edge.your-api.com/api/v1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.api_token = &quot;your-token&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.app_name = &quot;my-game&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.environment = &quot;production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.explicit_sync_mode = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var client = GatrixClient.new(config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var dark_mode = client.features.bool_variation(&quot;dark-mode&quot;, false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var max_retries = client.features.int_variation(&quot;max-retries&quot;, 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var game_speed = client.features.float_variation(&quot;game-speed&quot;, 1.0)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="python">Python<a href="#python" class="hash-link" aria-label="Python的直接链接" title="Python的直接链接">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> gatrix </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> GatrixClient</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GatrixClientConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GatrixContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GatrixClientConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api_url</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;https://edge.your-api.com/api/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api_token</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;your-token&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app_name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;my-app&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;production&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">GatrixContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        user_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;user-123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        properties</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;country&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;KR&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;level&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GatrixClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dark_mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bool_variation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dark-mode&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_items </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">int_variation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;max-items&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">speed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float_variation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;game-speed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="最佳实践">最佳实践<a href="#最佳实践" class="hash-link" aria-label="最佳实践的直接链接" title="最佳实践的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="标志设计">标志设计<a href="#标志设计" class="hash-link" aria-label="标志设计的直接链接" title="标志设计的直接链接">​</a></h3>
<ol>
<li><strong>使用 kebab-case</strong> — 一致且对静态分析友好</li>
<li><strong>选择正确的标志类型</strong> — 功能发布用 <code>release</code>，紧急开关用 <code>killSwitch</code>，调优值用 <code>remoteConfig</code></li>
<li><strong>设置有意义的禁用值</strong> — 标志关闭时用户应看到合理的默认值</li>
<li><strong>使用 <code>staleAfterDays</code></strong> — 设置过期阈值以识别应移除的标志</li>
<li><strong>为标志添加标签</strong> — 使用标签进行分类和过滤</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sdk-使用-1">SDK 使用<a href="#sdk-使用-1" class="hash-link" aria-label="SDK 使用的直接链接" title="SDK 使用的直接链接">​</a></h3>
<ol>
<li><strong>始终提供回退值</strong> — 确保网络故障时的恢复能力</li>
<li><strong>使用 <code>boolVariation</code> 而非 <code>isEnabled</code></strong> — 获取实际变体值，而非仅启用状态</li>
<li><strong>游戏使用显式同步模式</strong> — 防止帧/会话中标志变更干扰</li>
<li><strong>保持上下文最小化</strong> — 避免将频繁变化的值放入上下文</li>
<li><strong><code>start()</code> 调用一次，<code>stop()</code> 调用一次</strong> — SDK 生命周期应与应用生命周期匹配</li>
<li><strong>响应式 UI 使用 <code>watchFlag</code></strong> — 不要手动轮询</li>
<li><strong>渲染前处理 <code>flags.ready</code></strong> — 防止未加载标志导致的闪烁</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="性能">性能<a href="#性能" class="hash-link" aria-label="性能的直接链接" title="性能的直接链接">​</a></h3>
<ol>
<li><strong>标志读取在内存中</strong> — <code>isEnabled</code>、<code>*Variation</code> 在热路径中安全（游戏循环、渲染函数）</li>
<li><strong>上下文更新触发网络</strong> — 如果由用户输入驱动则进行防抖</li>
<li><strong>批量标志监视器</strong> — 使用 <code>WatchFlagGroup</code> 进行更清洁的生命周期管理</li>
<li><strong>使用引导实现即时加载</strong> — 消除首次获取前的加载间隙</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="参见">参见<a href="#参见" class="hash-link" aria-label="参见的直接链接" title="参见的直接链接">​</a></h2>
<ul>
<li><a href="/docs/zh-Hans/features/segments">分段</a> — 可复用用户组定向</li>
<li><a href="/docs/zh-Hans/features/environments">环境</a> — 按环境配置管理</li>
<li><a href="/docs/zh-Hans/sdks/client-side">客户端 SDK</a> — 平台特定 SDK 文档</li>
<li><a href="/docs/zh-Hans/sdks/game-engines">游戏引擎 SDK</a> — Unity、Unreal、Godot、Cocos2d-x</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/your-org/gatrix/tree/main/docs/docs/features/feature-flags.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/zh-Hans/getting-started/configuration"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">配置指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/zh-Hans/features/segments"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">受众群组</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a><ul><li><a href="#核心功能" class="table-of-contents__link toc-highlight">核心功能</a></li></ul></li><li><a href="#架构" class="table-of-contents__link toc-highlight">架构</a><ul><li><a href="#评估模型" class="table-of-contents__link toc-highlight">评估模型</a></li><li><a href="#核心设计原则" class="table-of-contents__link toc-highlight">核心设计原则</a></li></ul></li><li><a href="#创建功能标志" class="table-of-contents__link toc-highlight">创建功能标志</a><ul><li><a href="#标志类型用途" class="table-of-contents__link toc-highlight">标志类型（用途）</a></li><li><a href="#值类型" class="table-of-contents__link toc-highlight">值类型</a></li></ul></li><li><a href="#按环境设置" class="table-of-contents__link toc-highlight">按环境设置</a><ul><li><a href="#示例按环境设置" class="table-of-contents__link toc-highlight">示例：按环境设置</a></li></ul></li><li><a href="#策略" class="table-of-contents__link toc-highlight">策略</a><ul><li><a href="#策略评估流程" class="table-of-contents__link toc-highlight">策略评估流程</a></li><li><a href="#策略参数" class="table-of-contents__link toc-highlight">策略参数</a></li><li><a href="#发布分桶" class="table-of-contents__link toc-highlight">发布分桶</a></li></ul></li><li><a href="#约束" class="table-of-contents__link toc-highlight">约束</a><ul><li><a href="#约束结构" class="table-of-contents__link toc-highlight">约束结构</a></li><li><a href="#按类型分类的运算符" class="table-of-contents__link toc-highlight">按类型分类的运算符</a></li><li><a href="#inverted-标志" class="table-of-contents__link toc-highlight"><code>inverted</code> 标志</a></li></ul></li><li><a href="#分段" class="table-of-contents__link toc-highlight">分段</a><ul><li><a href="#分段结构" class="table-of-contents__link toc-highlight">分段结构</a></li><li><a href="#创建分段" class="table-of-contents__link toc-highlight">创建分段</a></li><li><a href="#在策略中使用分段" class="table-of-contents__link toc-highlight">在策略中使用分段</a></li></ul></li><li><a href="#上下文" class="table-of-contents__link toc-highlight">上下文</a><ul><li><a href="#评估上下文结构" class="table-of-contents__link toc-highlight">评估上下文结构</a></li><li><a href="#内置上下文字段" class="table-of-contents__link toc-highlight">内置上下文字段</a></li><li><a href="#自定义上下文字段-properties" class="table-of-contents__link toc-highlight">自定义上下文字段 (Properties)</a></li><li><a href="#预定义自定义字段" class="table-of-contents__link toc-highlight">预定义自定义字段</a></li></ul></li><li><a href="#变体" class="table-of-contents__link toc-highlight">变体</a><ul><li><a href="#变体结构" class="table-of-contents__link toc-highlight">变体结构</a></li><li><a href="#变体选择" class="table-of-contents__link toc-highlight">变体选择</a></li><li><a href="#保留变体名称" class="table-of-contents__link toc-highlight">保留变体名称</a></li></ul></li><li><a href="#sdk-使用" class="table-of-contents__link toc-highlight">SDK 使用</a><ul><li><a href="#可用客户端-sdk" class="table-of-contents__link toc-highlight">可用客户端 SDK</a></li><li><a href="#sdk-生命周期" class="table-of-contents__link toc-highlight">SDK 生命周期</a></li><li><a href="#初始化" class="table-of-contents__link toc-highlight">初始化</a></li><li><a href="#标志访问方法" class="table-of-contents__link toc-highlight">标志访问方法</a></li><li><a href="#上下文管理" class="table-of-contents__link toc-highlight">上下文管理</a></li><li><a href="#watch-模式响应式更新" class="table-of-contents__link toc-highlight">Watch 模式（响应式更新）</a></li><li><a href="#显式同步模式" class="table-of-contents__link toc-highlight">显式同步模式</a></li><li><a href="#事件" class="table-of-contents__link toc-highlight">事件</a></li><li><a href="#轮询和错误恢复" class="table-of-contents__link toc-highlight">轮询和错误恢复</a></li></ul></li><li><a href="#平台示例" class="table-of-contents__link toc-highlight">平台示例</a><ul><li><a href="#unity-c" class="table-of-contents__link toc-highlight">Unity (C#)</a></li><li><a href="#unreal-engine-c" class="table-of-contents__link toc-highlight">Unreal Engine (C++)</a></li><li><a href="#flutter-dart" class="table-of-contents__link toc-highlight">Flutter (Dart)</a></li><li><a href="#godot-gdscript" class="table-of-contents__link toc-highlight">Godot (GDScript)</a></li><li><a href="#python" class="table-of-contents__link toc-highlight">Python</a></li></ul></li><li><a href="#最佳实践" class="table-of-contents__link toc-highlight">最佳实践</a><ul><li><a href="#标志设计" class="table-of-contents__link toc-highlight">标志设计</a></li><li><a href="#sdk-使用-1" class="table-of-contents__link toc-highlight">SDK 使用</a></li><li><a href="#性能" class="table-of-contents__link toc-highlight">性能</a></li></ul></li><li><a href="#参见" class="table-of-contents__link toc-highlight">参见</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/zh-Hans/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/zh-Hans/api/client-api">API Reference</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/zh-Hans/backend/cache-keys">Cache System</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/your-org/gatrix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/your-org/gatrix/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/zh-Hans/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/your-org/gatrix" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Gatrix. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>