<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서비스 공지</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: #E8DDD0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }
        
        .sidebar {
            width: 320px;
            background: #2B2420;
            border-right: 1px solid #4A3D32;
            overflow-y: auto;
        }
        
        .notice-item {
            padding: 15px 20px;
            border-bottom: 1px solid #4A3D32;
            cursor: pointer;
            background: #2B2420;
            color: #E8DDD0;
            transition: background 0.2s;
        }
        
        .notice-item:nth-child(even) {
            background: #322822;
        }
        
        .notice-item:hover {
            background: #4A3D32;
        }
        
        .notice-item.selected {
            background: #C8B896;
            color: #2A1F18;
        }
        
        .notice-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .notice-date {
            font-size: 11px;
            opacity: 0.7;
        }
        
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .content-header {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.3);
            border-bottom: 1px solid rgba(155, 138, 120, 0.3);
            margin: -20px -20px 20px -20px;
        }
        
        .content-title {
            font-size: 24px;
            font-weight: bold;
            color: #3D3228;
            margin-bottom: 10px;
        }
        
        .content-meta {
            font-size: 12px;
            color: #6B5D52;
        }
        
        .content-body {
            color: #3D3228;
            line-height: 1.6;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 18px;
            color: #6B5D52;
        }
        
        .error {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #d32f2f;
            padding: 20px;
            text-align: center;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(107, 93, 82, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(107, 93, 82, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="loading">로딩 중...</div>
        </div>
        <div class="content-area" id="content">
            <div class="loading">공지를 선택하세요</div>
        </div>
    </div>

    <script>
        console.log('[Simple Preview] Page loaded');
        console.log('[Simple Preview] User Agent:', navigator.userAgent);
        
        var notices = [];
        var selectedNoticeId = null;
        
        // Format date
        function formatDate(dateStr) {
            var d = new Date(dateStr);
            var year = d.getFullYear();
            var month = String(d.getMonth() + 1).padStart(2, '0');
            var day = String(d.getDate()).padStart(2, '0');
            var hours = String(d.getHours()).padStart(2, '0');
            var minutes = String(d.getMinutes()).padStart(2, '0');
            return year + '. ' + month + '. ' + day + '. ' + hours + ':' + minutes;
        }
        
        // Render sidebar
        function renderSidebar() {
            var sidebar = document.getElementById('sidebar');

            if (notices.length === 0) {
                sidebar.innerHTML = '<div class="loading">공지가 없습니다</div>';
                return;
            }

            var html = '';
            for (var i = 0; i < notices.length; i++) {
                var notice = notices[i];
                var selected = notice.id === selectedNoticeId ? ' selected' : '';
                html += '<div class="notice-item' + selected + '" onclick="selectNotice(' + notice.id + ')">';
                html += '<div class="notice-title">' + (notice.tabTitle || notice.title) + '</div>';
                html += '</div>';
            }

            sidebar.innerHTML = html;
        }
        
        // Render content
        function renderContent() {
            var content = document.getElementById('content');
            
            if (!selectedNoticeId) {
                content.innerHTML = '<div class="loading">공지를 선택하세요</div>';
                return;
            }
            
            var notice = null;
            for (var i = 0; i < notices.length; i++) {
                if (notices[i].id === selectedNoticeId) {
                    notice = notices[i];
                    break;
                }
            }
            
            if (!notice) {
                content.innerHTML = '<div class="error">공지를 찾을 수 없습니다</div>';
                return;
            }
            
            var html = '';
            html += '<div class="content-header">';
            html += '<div class="content-title">' + notice.title + '</div>';
            html += '<div class="content-meta">' + formatDate(notice.startDate) + ' ~ ' + formatDate(notice.endDate) + '</div>';
            html += '</div>';
            html += '<div class="content-body">' + notice.content + '</div>';
            
            content.innerHTML = html;
        }
        
        // Select notice
        function selectNotice(id) {
            console.log('[Simple Preview] Selecting notice:', id);
            selectedNoticeId = id;
            renderSidebar();
            renderContent();
        }
        
        // Load notices
        function loadNotices() {
            console.log('[Simple Preview] Loading notices...');

            // Use public API endpoint (no authentication required)
            var hostname = window.location.hostname;
            var apiUrl = window.location.protocol + '//' + hostname + ':5000/api/v1/service-notices?page=1&limit=100';
            console.log('[Simple Preview] API URL:', apiUrl);
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', apiUrl, true);
            
            xhr.onload = function() {
                console.log('[Simple Preview] API response status:', xhr.status);
                
                if (xhr.status === 200) {
                    try {
                        var response = JSON.parse(xhr.responseText);
                        console.log('[Simple Preview] API response:', response);
                        
                        if (response && response.notices) {
                            // Filter active notices
                            var now = new Date();
                            var activeNotices = [];
                            
                            for (var i = 0; i < response.notices.length; i++) {
                                var notice = response.notices[i];
                                var startDate = new Date(notice.startDate);
                                var endDate = new Date(notice.endDate);
                                
                                if (now >= startDate && now <= endDate) {
                                    activeNotices.push(notice);
                                }
                            }
                            
                            console.log('[Simple Preview] Active notices:', activeNotices.length);
                            notices = activeNotices;
                            
                            // Select first notice
                            if (notices.length > 0) {
                                selectedNoticeId = notices[0].id;
                            }
                            
                            renderSidebar();
                            renderContent();
                        } else {
                            console.error('[Simple Preview] Invalid response format');
                            document.getElementById('sidebar').innerHTML = '<div class="error">응답 형식 오류</div>';
                        }
                    } catch (e) {
                        console.error('[Simple Preview] JSON parse error:', e);
                        document.getElementById('sidebar').innerHTML = '<div class="error">JSON 파싱 오류: ' + e.message + '</div>';
                    }
                } else {
                    console.error('[Simple Preview] API error:', xhr.status, xhr.statusText);
                    document.getElementById('sidebar').innerHTML = '<div class="error">API 오류: ' + xhr.status + ' ' + xhr.statusText + '</div>';
                }
            };
            
            xhr.onerror = function() {
                console.error('[Simple Preview] Network error');
                document.getElementById('sidebar').innerHTML = '<div class="error">네트워크 오류</div>';
            };
            
            xhr.send();
        }
        
        // Initialize
        loadNotices();
    </script>
</body>
</html>

