<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서비스 공지</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: #E8DDD0;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }
        
        .sidebar {
            width: 320px;
            background: #2B2420;
            border-right: 1px solid #4A3D32;
            overflow-y: auto;
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 3px,
                rgba(74, 63, 53, 0.15) 3px,
                rgba(74, 63, 53, 0.15) 6px
            );
        }
        
        .notice-item {
            padding: 15px 20px;
            min-height: 80px;
            border-bottom: 1px solid #4A3D32;
            cursor: pointer;
            background: #2B2420;
            color: #E8DDD0;
            transition: background 0.2s;
            display: flex;
            align-items: center;
        }
        
        .notice-item:nth-child(even) {
            background: #322822;
        }
        
        .notice-item:hover {
            background: #4A3D32;
        }
        
        .notice-item.selected {
            background: #C8B896;
            color: #2A1F18;
        }

        .notice-item-content {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }

        .notice-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notice-icon svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .notice-item.selected .notice-icon svg {
            fill: #2A1F18;
        }

        .notice-title {
            font-weight: bold;
            font-size: 14px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .unread-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .unread-icon svg {
            width: 18px;
            height: 18px;
            fill: #D32F2F;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .notice-date {
            font-size: 11px;
            opacity: 0.7;
            text-align: right;
        }
        
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .content-header {
            padding: 15px 20px;
            min-height: 80px;
            background: rgba(255, 255, 255, 0.3);
            border-bottom: 1px solid rgba(155, 138, 120, 0.3);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .content-title {
            font-size: 24px;
            font-weight: bold;
            color: #3D3228;
            margin-bottom: 10px;
        }
        
        .content-meta {
            font-size: 12px;
            color: #6B5D52;
        }
        
        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            color: #3D3228;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .content-body img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            border: 2px solid #4A3D32;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            display: block;
            margin: 0.5em 0;
        }

        .content-body a {
            color: #8B4513;
            text-decoration: underline;
            font-weight: 600;
        }

        .content-body a:hover {
            color: #A0522D;
        }

        .content-body p {
            margin: 0 0 0.5em 0;
            word-wrap: break-word;
        }

        .content-body p:last-child {
            margin-bottom: 0;
        }

        .content-body h1,
        .content-body h2,
        .content-body h3,
        .content-body h4,
        .content-body h5,
        .content-body h6 {
            color: #3D3228;
            font-weight: 700;
            margin-top: 1em;
            margin-bottom: 0.3em;
        }

        .content-body ul,
        .content-body ol {
            padding-left: 2em;
            margin: 0.5em 0;
        }

        .content-body li {
            margin-bottom: 0.2em;
        }

        .content-body br {
            line-height: 1.2;
        }

        .content-body iframe {
            max-width: 100%;
            border: none;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 18px;
            color: #6B5D52;
        }
        
        .error {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #d32f2f;
            padding: 20px;
            text-align: center;
            flex-direction: column;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(107, 93, 82, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(107, 93, 82, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="loading">로딩 중...</div>
        </div>
        <div class="content-area">
            <div id="content" style="flex: 1; display: flex; align-items: center; justify-content: center;">
                <div class="loading">공지를 선택하세요</div>
            </div>
        </div>
    </div>

    <script>
        var notices = [];
        var selectedNoticeId = null;
        var readNotices = new Set();

        // Load read notices from localStorage
        try {
            var stored = localStorage.getItem('serviceNotices_readStatus');
            if (stored) {
                readNotices = new Set(JSON.parse(stored));
            }
        } catch (e) {
            console.error('Failed to load read notices:', e);
        }

        // Save read notices to localStorage
        function saveReadNotices() {
            try {
                localStorage.setItem('serviceNotices_readStatus', JSON.stringify(Array.from(readNotices)));
            } catch (e) {
                console.error('Failed to save read notices:', e);
            }
        }

        // Check if notice is read
        function isNoticeRead(noticeId) {
            return readNotices.has(noticeId);
        }

        // Mark notice as read
        function markAsRead(noticeId) {
            if (!readNotices.has(noticeId)) {
                readNotices.add(noticeId);
                saveReadNotices();
            }
        }

        // Get category icon SVG
        function getCategoryIcon(category) {
            switch (category) {
                case 'maintenance':
                    return '<svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>';
                case 'event':
                    return '<svg viewBox="0 0 24 24"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"/></svg>';
                case 'notice':
                    return '<svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z"/></svg>';
                case 'promotion':
                    return '<svg viewBox="0 0 24 24"><path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/></svg>';
                default:
                    return '<svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>';
            }
        }

        // Get unread icon SVG
        function getUnreadIcon() {
            return '<svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>';
        }

        // Format date
        function formatDate(dateStr) {
            var d = new Date(dateStr);
            var year = d.getFullYear();
            var month = String(d.getMonth() + 1).padStart(2, '0');
            var day = String(d.getDate()).padStart(2, '0');
            var hours = String(d.getHours()).padStart(2, '0');
            var minutes = String(d.getMinutes()).padStart(2, '0');
            return year + '. ' + month + '. ' + day + '. ' + hours + ':' + minutes;
        }
        
        // Render sidebar
        function renderSidebar() {
            var sidebar = document.getElementById('sidebar');

            if (notices.length === 0) {
                sidebar.innerHTML = '<div class="loading">공지가 없습니다</div>';
                return;
            }

            var html = '';
            for (var i = 0; i < notices.length; i++) {
                var notice = notices[i];
                var selected = notice.id === selectedNoticeId ? ' selected' : '';
                var isRead = isNoticeRead(notice.id);

                html += '<div class="notice-item' + selected + '" onclick="selectNotice(' + notice.id + ')">';
                html += '<div class="notice-item-content">';

                // Category icon
                html += '<div class="notice-icon">' + getCategoryIcon(notice.category) + '</div>';

                // Title
                html += '<div class="notice-title" style="font-weight: ' + (isRead ? '400' : '700') + ';">';
                html += (notice.tabTitle || notice.title);
                html += '</div>';

                // Unread indicator
                if (!isRead) {
                    html += '<div class="unread-icon">' + getUnreadIcon() + '</div>';
                }

                html += '</div>';
                html += '</div>';
            }

            sidebar.innerHTML = html;
        }
        
        // Render content
        function renderContent() {
            var content = document.getElementById('content');

            if (!selectedNoticeId) {
                content.style.cssText = 'flex: 1; display: flex; align-items: center; justify-content: center;';
                content.innerHTML = '<div class="loading">공지를 선택하세요</div>';
                return;
            }

            var notice = null;
            for (var i = 0; i < notices.length; i++) {
                if (notices[i].id === selectedNoticeId) {
                    notice = notices[i];
                    break;
                }
            }

            if (!notice) {
                content.style.cssText = 'flex: 1; display: flex; align-items: center; justify-content: center;';
                content.innerHTML = '<div class="error">공지를 찾을 수 없습니다</div>';
                return;
            }

            // Reset style for content display
            content.style.cssText = 'flex: 1; display: flex; flex-direction: column; overflow: hidden;';

            var html = '';
            html += '<div class="content-header">';
            html += '<div class="content-title">' + notice.title + '</div>';
            html += '<div class="content-meta">' + formatDate(notice.startDate) + ' ~ ' + formatDate(notice.endDate) + '</div>';
            html += '</div>';
            html += '<div class="content-body">' + notice.content + '</div>';

            content.innerHTML = html;
        }
        
        // Select notice
        function selectNotice(id) {
            selectedNoticeId = id;
            markAsRead(id);
            renderSidebar();
            renderContent();
        }
        
        // Load notices
        function loadNotices() {
            // Use public API endpoint (no authentication required)
            var hostname = window.location.hostname;
            var apiUrl = window.location.protocol + '//' + hostname + ':5000/api/v1/service-notices?page=1&limit=100';

            var xhr = new XMLHttpRequest();
            xhr.open('GET', apiUrl, true);

            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        var response = JSON.parse(xhr.responseText);

                        // Check for the correct response structure
                        if (response && response.success && response.data && response.data.notices) {
                            // Filter active notices
                            var now = new Date();
                            var activeNotices = [];

                            for (var i = 0; i < response.data.notices.length; i++) {
                                var notice = response.data.notices[i];
                                var startDate = new Date(notice.startDate);
                                var endDate = new Date(notice.endDate);

                                if (now >= startDate && now <= endDate) {
                                    activeNotices.push(notice);
                                }
                            }

                            notices = activeNotices;

                            // Select first notice
                            if (notices.length > 0) {
                                selectedNoticeId = notices[0].id;
                            }

                            renderSidebar();
                            renderContent();
                        } else {
                            document.getElementById('sidebar').innerHTML = '<div class="error">응답 형식 오류</div>';
                        }
                    } catch (e) {
                        document.getElementById('sidebar').innerHTML = '<div class="error">JSON 파싱 오류<br>' + e.message + '</div>';
                    }
                } else {
                    document.getElementById('sidebar').innerHTML = '<div class="error">API 오류<br>' + xhr.status + ' ' + xhr.statusText + '</div>';
                }
            };

            xhr.onerror = function() {
                document.getElementById('sidebar').innerHTML = '<div class="error">네트워크 오류<br>API 서버에 연결할 수 없습니다</div>';
            };

            xhr.send();
        }

        // Initialize
        loadNotices();
    </script>
</body>
</html>

