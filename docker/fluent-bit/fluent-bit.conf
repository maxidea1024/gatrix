[SERVICE]
  Flush        1
  Daemon       Off
  Log_Level    info
  Parsers_File /fluent-bit/etc/parsers.conf

[INPUT]
  Name              tail
  Path              /var/lib/docker/containers/*/*-json.log
  Tag               docker.*
  Mem_Buf_Limit     10MB
  Skip_Long_Lines   On
  Refresh_Interval  10
  Docker_Mode       On
  Docker_Mode_Flush 1
  Parser            docker

[FILTER]
  Name              parser
  Match             docker.*
  Key_Name          log
  Parser            json
  Reserve_Data      On
  Preserve_Key      Off

[FILTER]
  Name              record_modifier
  Match             docker.*
  Remove_key        service_name

# Only keep logs from Gatrix services (exclude Loki, Prometheus, etc.)
[FILTER]
  Name              grep
  Match             docker.*
  Regex             service ^gatrix-

[OUTPUT]
  Name              loki
  Match             docker.*
  Host              loki
  Port              3100
  labels            job=gatrix
  label_keys        $service,$category,$internalIp,$externalIp,$level,$hostname
  drop_single_key   off
  line_format       json
  auto_kubernetes_labels off

