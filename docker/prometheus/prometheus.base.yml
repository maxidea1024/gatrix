global:
  scrape_interval: __SCRAPE_INTERVAL__
  evaluation_interval: __SCRAPE_INTERVAL__

scrape_configs:
  # Static scrape for known services (fallback)
  - job_name: 'gatrix-static'
    metrics_path: /metrics
    static_configs:
      - targets:
          - backend:5000
          - event-lens:3002
      - targets:
          - chat-server:9090
        labels:
          service: chat

  # Discovered services via Backend HTTP-SD
  - job_name: 'gatrix-discovered'
    metrics_path: /metrics
    scheme: http
    http_sd_configs:
      - url: http://backend:5000/api/v1/public/monitoring/prometheus/targets
        refresh_interval: 30s
    relabel_configs:
      # Respect metrics_path from target labels if provided
      - source_labels: [metrics_path]
        target_label: __metrics_path__

