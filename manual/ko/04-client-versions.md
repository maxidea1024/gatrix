# 제 5장: 클라이언트 버전 관리 (Client Version Management)

앱 업데이트 시 가장 핵심이 되는 기능입니다. 사용자의 앱 버전과 서버의 허용 버전을 매칭하여 "업데이트를 받을지", "게임을 계속할지"를 결정합니다.

**경로:** 관리 (Admin) → 클라이언트 버전 (Client Versions)  
**필요 권한:** `client-versions_manage`

---

## 1. 버전 상태 (Status) 완전 정복

상태를 잘못 설정하면 유저가 게임에 접속하지 못하거나, 심각한 버그가 있는 버전으로 계속 게임을 하게 됩니다.

| 상태 | 화면 예시 | 언제 쓰나요? |
|---|---|---|
| **OK (정상)** | (아무 팝업 없음) | 현재 문제가 없는 최신 버전일 때 |
| **Update Recommended (권장)** | "새로운 기능이 추가되었습니다. 업데이트 할까요? [나중에] [업데이트]" | 마이너 버그 수정, 편의성 개선 등 필수는 아닐 때 |
| **Update Required (필수)** | "필수 리소스 패치가 필요합니다. 스토어로 이동합니다. [확인]" | **새로운 시즌 시작**, 치명적 버그 수정 시 |
| **Maintenance (점검)** | "현재 버전 점검 중입니다. (14:00~16:00)" | 특정 버전에서만 크래시가 발생하여 막아야 할 때 |
| **Blocked (차단)** | "지원하지 않는 버전입니다." | 너무 오래되어 서버 API와 호환되지 않는 버전 |

---

## 2. 업데이트 배포 시나리오 (Workflow)

신규 버전 `1.2.0`을 배포하는 상황을 가정해 봅시다. 현재 버전은 `1.1.0`입니다.

### 1단계: 마켓 심사 및 배포
- 구글/애플 스토어에 `1.2.0` 앱을 제출하고 심사를 받습니다.
- 심사가 통과되어 마켓에 **출시(Release)** 상태가 되었습니다.

### 2단계: Gatrix에 새 버전 등록
1. Gatrix → 클라이언트 버전 메뉴 접속
2. **[+ 버전 추가]** 클릭
   - 버전: `1.2.0`
   - 상태: `OK` (일단 접속은 가능하게)
   - 스토어 URL: 마켓 주소 확인
3. **[저장]**

> **상태:** 이 시점에는 `1.1.0` 유저는 `OK`, `1.2.0` 유저도 `OK`입니다. (자연스러운 업데이트 유도)

### 3단계: 강제 업데이트 전환 (점검 시간)
서버 점검 시간이 되었습니다. 이제 구버전을 막고 신버전만 쓰게 해야 합니다.

1. `1.1.0` 버전 수정 클릭
2. 상태를 **Update Required (필수)**로 변경
3. 메시지 확인: "원활한 게임 이용을 위해 업데이트가 필요합니다."
4. **[저장]**

> **결과:** 이제 `1.1.0`으로 접속한 유저는 강제로 스토어로 보내집니다. `1.2.0` 업데이트를 받아야만 접속 가능합니다.

---

## 3. 긴급 대응 시나리오

### 상황: 방금 배포한 1.2.0 버전에서 치명적인 버그 발견!

유저들이 "1.2.0 업데이트하고 나서 결제가 안 돼요!"라고 제보합니다.

**대응 방법:**
1. `1.2.0` 버전을 찾아서 상태를 **Blocked** 또는 **Maintenance**로 변경합니다.
   - 메시지: "치명적인 오류로 인해 잠시 구버전 이용을 부탁드립니다."
2. `1.1.0` (구버전)의 상태를 다시 **OK**로 풀어줍니다.
3. 공지사항을 통해 "구버전을 다시 설치해 달라"고 안내합니다. (최악의 경우지만 결제 불가보다는 낫습니다.)

---

## 4. 버전 관리 체크리스트 (Checklist)

업데이트 점검 들어가기 전, 다음 항목을 반드시 체크하세요.

- [ ] **스토어 URL 검증:** 업데이트 버튼을 눌렀을 때 엉뚱한 페이지나 깨진 링크로 가지 않는가?
- [ ] **메시지 다국어:** "업데이트가 필요합니다" 메시지가 영어/일본어/중국어로 잘 등록되어 있는가? (빈칸이면 팝업 내용이 비어서 나옴)
- [ ] **플랫폼 구분:** iOS는 심사가 반려되었는데 Android만 강제 업데이트를 걸어버리지 않았는가? (iOS 유저 전멸함)
- [ ] **QA 테스트:** 실제 단말기에서 구버전을 설치하고 접속했을 때, 팝업이 뜨고 스토어로 잘 이동하는가?

---

**이전 장:** [← 제 4장: API 토큰 관리](17-api-tokens.md)  
**다음 장:** [제 6장: 게임 월드 관리 →](05-game-worlds.md)
