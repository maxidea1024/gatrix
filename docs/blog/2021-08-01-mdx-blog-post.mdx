---
slug: real-time-chat-server-setup
title: Gatrix ì‹¤ì‹œê°„ ì±„íŒ… ì„œë²„ ì™„ì „ ì„¤ì • ê°€ì´ë“œ
authors: [gatrix-team]
tags: [gatrix, chat, tutorial, setup]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

Gatrixì˜ ì‹¤ì‹œê°„ ì±„íŒ… ì„œë²„ëŠ” Socket.IOì™€ Redis í´ëŸ¬ìŠ¤í„°ë§ì„ ì‚¬ìš©í•˜ì—¬ ê³ ì„±ëŠ¥ ë©”ì‹œì§•ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ê°€ì´ë“œì—ì„œëŠ” ì±„íŒ… ì„œë²„ë¥¼ ì„¤ì •í•˜ê³  ìµœì í™”í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

export const Highlight = ({children, color}) => (
  <span
    style={{
      backgroundColor: color,
      borderRadius: '2px',
      color: '#fff',
      padding: '0.2rem',
    }}>
    {children}
  </span>
);

<Highlight color="#25c2a0">ê³ ì„±ëŠ¥</Highlight> ì‹¤ì‹œê°„ ì±„íŒ… ì„œë²„ë¡œ ê²Œì„ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ê°•í™”í•˜ì„¸ìš”!

{/* truncate */}

## ğŸš€ ì±„íŒ… ì„œë²„ ì•„í‚¤í…ì²˜

Gatrix ì±„íŒ… ì„œë²„ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

- **Socket.IO ê¸°ë°˜**: WebSocketê³¼ í´ë§ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬
- **Redis í´ëŸ¬ìŠ¤í„°ë§**: ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ ë™ê¸°í™”
- **ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŒ…**: 100,000+ ë©”ì‹œì§€/ì´ˆ ì²˜ë¦¬
- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **ìë™ í™•ì¥**: ìˆ˜í‰ì  í™•ì¥ ì§€ì›

## ğŸ“¦ ì„¤ì¹˜ ë° ì„¤ì •

### 1. ê¸°ë³¸ ì„¤ì¹˜

<Tabs>
  <TabItem value="npm" label="npm" default>
    ```bash
    # ì±„íŒ… ì„œë²„ íŒ¨í‚¤ì§€ë¡œ ì´ë™
    cd packages/chat-server
    
    # ì˜ì¡´ì„± ì„¤ì¹˜
    npm install
    
    # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    cp .env.example .env
    ```
  </TabItem>
  <TabItem value="yarn" label="yarn">
    ```bash
    # ì±„íŒ… ì„œë²„ íŒ¨í‚¤ì§€ë¡œ ì´ë™
    cd packages/chat-server
    
    # ì˜ì¡´ì„± ì„¤ì¹˜
    yarn install
    
    # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    cp .env.example .env
    ```
  </TabItem>
  <TabItem value="docker" label="Docker">
    ```bash
    # Docker Composeë¡œ ì „ì²´ ìŠ¤íƒ ì‹¤í–‰
    docker-compose up -d
    
    # ë˜ëŠ” ì±„íŒ… ì„œë²„ë§Œ ì‹¤í–‰
    docker-compose up chat-server
    ```
  </TabItem>
</Tabs>

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

<CodeBlock language="bash">
{`# ì„œë²„ ì„¤ì •
NODE_ENV=production
PORT=3001
HOST=0.0.0.0

# ë°ì´í„°ë² ì´ìŠ¤
DB_HOST=localhost
DB_PORT=3306
DB_NAME=gatrix_chat
DB_USER=chat_user
DB_PASSWORD=your_password

# Redis í´ëŸ¬ìŠ¤í„°
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password

# Gatrix ë©”ì¸ ì„œë²„ ì—°ë™
GATRIX_API_URL=http://localhost:5001
GATRIX_API_SECRET=shared_secret

# ì„±ëŠ¥ íŠœë‹
CLUSTER_ENABLED=true
WS_MAX_CONNECTIONS=10000
BROADCAST_BATCH_SIZE=1000`}
</CodeBlock>

## ğŸ”§ í•µì‹¬ ê¸°ëŠ¥ ì„¤ì •

### 1. ì±„ë„ ê´€ë¦¬

<Tabs>
  <TabItem value="create" label="ì±„ë„ ìƒì„±" default>
    ```javascript
    // ì±„ë„ ìƒì„± API
    POST /api/v1/channels
    {
      "name": "ì¼ë°˜ ì±„íŒ…",
      "description": "ëª¨ë“  ì‚¬ìš©ìê°€ ì°¸ì—¬í•  ìˆ˜ ìˆëŠ” ì±„ë„",
      "type": "public",
      "maxMembers": 1000
    }
    ```
  </TabItem>
  <TabItem value="join" label="ì±„ë„ ì°¸ì—¬">
    ```javascript
    // WebSocketìœ¼ë¡œ ì±„ë„ ì°¸ì—¬
    socket.emit('join_channel', {
      channelId: 'channel_123',
      userId: 'user_456'
    });
    ```
  </TabItem>
  <TabItem value="leave" label="ì±„ë„ ë‚˜ê°€ê¸°">
    ```javascript
    // WebSocketìœ¼ë¡œ ì±„ë„ ë‚˜ê°€ê¸°
    socket.emit('leave_channel', {
      channelId: 'channel_123',
      userId: 'user_456'
    });
    ```
  </TabItem>
</Tabs>

### 2. ë©”ì‹œì§€ ì „ì†¡

<CodeBlock language="javascript">
{`// ë©”ì‹œì§€ ì „ì†¡
socket.emit('send_message', {
  channelId: 'channel_123',
  content: 'ì•ˆë…•í•˜ì„¸ìš”!',
  type: 'text',
  metadata: {
    mentions: ['user_456'],
    replyTo: 'message_789'
  }
});

// ì„œë²„ì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ 
socket.on('message', (data) => {
  console.log('ìƒˆ ë©”ì‹œì§€:', data);
  // {
  //   id: 'msg_123',
  //   channelId: 'channel_123',
  //   userId: 'user_456',
  //   content: 'ì•ˆë…•í•˜ì„¸ìš”!',
  //   timestamp: '2024-01-15T10:30:00Z',
  //   type: 'text'
  // }
});`}
</CodeBlock>

### 3. ì‹¤ì‹œê°„ ê¸°ëŠ¥

<Tabs>
  <TabItem value="typing" label="íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°" default>
    ```javascript
    // íƒ€ì´í•‘ ì‹œì‘
    socket.emit('typing_start', {
      channelId: 'channel_123',
      userId: 'user_456'
    });
    
    // íƒ€ì´í•‘ ì¤‘ì§€
    socket.emit('typing_stop', {
      channelId: 'channel_123',
      userId: 'user_456'
    });
    ```
  </TabItem>
  <TabItem value="presence" label="ì‚¬ìš©ì ìƒíƒœ">
    ```javascript
    // ì˜¨ë¼ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
    socket.emit('presence_update', {
      status: 'online',
      lastSeen: new Date().toISOString()
    });
    ```
  </TabItem>
  <TabItem value="reactions" label="ë©”ì‹œì§€ ë°˜ì‘">
    ```javascript
    // ë©”ì‹œì§€ì— ë°˜ì‘ ì¶”ê°€
    socket.emit('add_reaction', {
      messageId: 'msg_123',
      emoji: 'ğŸ‘',
      userId: 'user_456'
    });
    ```
  </TabItem>
</Tabs>

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### 1. ë©”ì‹œì§€ ë¸Œë¡œë“œìºìŠ¤íŒ… ìµœì í™”

<CodeBlock language="javascript">
{`// ë°°ì¹˜ ì²˜ë¦¬ë¡œ ë©”ì‹œì§€ ì „ì†¡
const broadcastService = {
  async broadcastMessage(channelId, message) {
    const members = await this.getChannelMembers(channelId);
    
    // 1000ê°œì”© ë°°ì¹˜ë¡œ ë‚˜ëˆ„ì–´ ì „ì†¡
    const batches = this.chunkArray(members, 1000);
    
    for (const batch of batches) {
      await this.sendBatch(batch, message);
    }
  },
  
  async sendBatch(members, message) {
    const promises = members.map(member => 
      this.sendToUser(member.userId, message)
    );
    
    await Promise.all(promises);
  }
};`}
</CodeBlock>

### 2. Redis í´ëŸ¬ìŠ¤í„° ì„¤ì •

<CodeBlock language="yaml">
{`# docker-compose.yml
version: '3.8'
services:
  redis-cluster:
    image: redis:7-alpine
    command: redis-server --cluster-enabled yes --cluster-config-file nodes.conf --cluster-node-timeout 5000 --appendonly yes
    ports:
      - "7000:7000"
      - "7001:7001"
      - "7002:7002"
    volumes:
      - redis-data:/data

  chat-server:
    build: ./packages/chat-server
    environment:
      - REDIS_CLUSTER_NODES=redis-cluster:7000,redis-cluster:7001,redis-cluster:7002
    depends_on:
      - redis-cluster`}
</CodeBlock>

### 3. ëª¨ë‹ˆí„°ë§ ì„¤ì •

<Tabs>
  <TabItem value="prometheus" label="Prometheus ë©”íŠ¸ë¦­" default>
    ```javascript
    // ë©”íŠ¸ë¦­ ìˆ˜ì§‘
    const prometheus = require('prom-client');
    
    const messageCounter = new prometheus.Counter({
      name: 'chat_messages_total',
      help: 'Total number of messages sent',
      labelNames: ['channel', 'type']
    });
    
    const connectionGauge = new prometheus.Gauge({
      name: 'chat_connections_active',
      help: 'Number of active connections'
    });
    ```
  </TabItem>
  <TabItem value="grafana" label="Grafana ëŒ€ì‹œë³´ë“œ">
    ```json
    {
      "dashboard": {
        "title": "Gatrix Chat Server",
        "panels": [
          {
            "title": "Active Connections",
            "type": "graph",
            "targets": [
              {
                "expr": "chat_connections_active"
              }
            ]
          },
          {
            "title": "Messages per Second",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(chat_messages_total[5m])"
              }
            ]
          }
        ]
      }
    }
    ```
  </TabItem>
</Tabs>

## ğŸ”’ ë³´ì•ˆ ì„¤ì •

### 1. JWT ì¸ì¦

<CodeBlock language="javascript">
{`// JWT í† í° ê²€ì¦ ë¯¸ë“¤ì›¨ì–´
const jwt = require('jsonwebtoken');

const authenticateSocket = (socket, next) => {
  const token = socket.handshake.auth.token;
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    socket.userId = decoded.userId;
    socket.userRole = decoded.role;
    next();
  } catch (error) {
    next(new Error('Authentication failed'));
  }
};

io.use(authenticateSocket);`}
</CodeBlock>

### 2. Rate Limiting

<CodeBlock language="javascript">
{`// ë©”ì‹œì§€ ì „ì†¡ ì œí•œ
const rateLimiter = new RateLimiter({
  keyGenerator: (socket) => socket.userId,
  points: 10, // 10ê°œ ë©”ì‹œì§€
  duration: 60, // 1ë¶„ ë™ì•ˆ
});

socket.on('send_message', async (data) => {
  try {
    await rateLimiter.consume(socket.userId);
    // ë©”ì‹œì§€ ì²˜ë¦¬
  } catch (rejRes) {
    socket.emit('rate_limit_exceeded', {
      retryAfter: rejRes.msBeforeNext
    });
  }
});`}
</CodeBlock>

## ğŸš€ ë°°í¬ ë° í™•ì¥

### 1. Docker ë°°í¬

<CodeBlock language="dockerfile">
{`# Dockerfile
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 3001

CMD ["npm", "start"]`}
</CodeBlock>

### 2. ë¡œë“œ ë°¸ëŸ°ì‹±

<CodeBlock language="nginx">
{`# nginx.conf
upstream chat_servers {
    ip_hash; # Sticky session
    server chat-server-1:3001;
    server chat-server-2:3001;
    server chat-server-3:3001;
}

server {
    listen 80;
    server_name chat.gatrix.com;
    
    location / {
        proxy_pass http://chat_servers;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}`}
</CodeBlock>

## ğŸ¯ ê²°ë¡ 

Gatrix ì±„íŒ… ì„œë²„ëŠ” ê³ ì„±ëŠ¥ ì‹¤ì‹œê°„ í†µì‹ ì„ ìœ„í•œ ì™„ì „í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ê°€ì´ë“œë¥¼ ë”°ë¼ ì„¤ì •í•˜ë©´ í™•ì¥ ê°€ëŠ¥í•˜ê³  ì•ˆì •ì ì¸ ì±„íŒ… ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ í¬ìŠ¤íŠ¸ì—ì„œëŠ” API í†µí•©ê³¼ ì›¹í›… ì„¤ì •ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤!

---

**ê´€ë ¨ ìë£Œ**:
- [ì±„íŒ… ì„œë²„ ë¬¸ì„œ](/packages/chat-server/README.md)
- [API ë¬¸ì„œ](/docs/api/client-api)
- [GitHub ì €ì¥ì†Œ](https://github.com/motifgames/gatrix)
